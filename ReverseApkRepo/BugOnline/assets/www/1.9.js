(function(e){e.fn.rssReader=function(t){if(r[t]){return r[t].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof t==="object"||!t){return r.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.rssReader")}}};var b={},d=[],p=false;var r={init:function(t){b=e.extend(b,t||{});return this},load:function(t,A,z,u,w){var B;if(u){c(t)}else{B=s(t)}if(B){A(B,true)}else{var y=function(E,D,F){console.log("RSS SUCCESS STATUS "+D+" HTTP "+F.status);if(F.status===200||F.status===0){if(!e.isXMLDoc(E)){E=h(m(E))}if(e.isXMLDoc(E)){var C=j(e(E),w);l(t,C);(A||e.noop)(C,false)}else{x(F,D)}}else{x(F,D)}};var x=function(E,D,C){console.log("RSS ERROR STATUS "+D+(C?" EXCEPTION "+C.message:""));if(!p){(z||e.noop)()}};var v=function(D,C){(b.onAjaxComplete||e.noop)()};(b.onAjaxStart||e.noop)();d.push(e.ajax({url:t,dataType:"text",success:y,error:x,complete:v}));return this}},convert:function(v,x,u){var w=h(v);var t=j(e(w));if(t.length>0){(x||e.noop)(t)}else{(u||e.noop)()}},abort:function(){p=true;e.each(d,function(t,u){u.abort()});d=[];p=false}};var f={};var g=10*60*1000;var m=function(t){return t.replace(/^\s+/,"")};var k=function(){var t="";for(var u=0;u<arguments.length;u++){t=arguments[u];if(t&&t!==""){return t}}return t};var s=function(v){var t;var w=f[v];if(w){var u=new Date().getTime();if(u-w.cachedAt<=g){t=w.items}else{c(v)}}return t};var l=function(u,t){f[u]={items:t,cachedAt:new Date().getTime()}};var j=function(u,x){var t=[];var v=u.children().children("channel");if(v.length===1){n(v,t,x)}else{var w=u.children("feed");if(w.length===1){a(w,t,x)}}return t};var c=function(t){f[t]=undefined;delete f[t]};var n=function(v,t,w){var u=v.children("item");if(w&&w>0){u=u.slice(0,w)}u.each(function(z){var A=e(this),y;var x={id:k(A.find("guid").text(),A.find("link").text(),i((A.children("title").text()||"")+(A.find("pubDate").text()||""))),title:A.children("[nodeName='media:title']").text()||A.children("title").text()||"",content:A.find("[nodeName='content:encoded']").text()||"",summary:A.find("[nodeName='media:description']").text()||A.find("description").text()||"",category:A.find("category").text(),published:(y=A.find("pubDate").text())?new Date(y).getTime():0,author:{name:A.find("[nodeName='media:credit']:first").text()||A.find("[nodeName='dc:creator']").text()||A.find("[nodeName='itunes:author']").text()||A.find("[nodeName='posterous:author']").find("[nodeName='posterous:displayName']").text()||A.find("author").text()},articleLink:A.find("link").text(),images:[],thumbnail:null,audioLinks:[],videoLinks:[],likeable:true,commentable:"yes"};A.find("enclosure").each(function(){var D=e(this);var C=D.attr("type")||"";var B=D.attr("url");if(C.indexOf("image/")>=0&&x.images.indexOf(B)===-1){x.images.push(B)}else{if(C.indexOf("audio/")>=0&&x.audioLinks.indexOf(B)===-1){x.audioLinks.push(B)}}});A.find("[nodeName='media:content']").each(function(){var E=e(this);var D=E.attr("type")||"";var B=E.attr("medium")||"";var C=E.attr("url");if((D.indexOf("image/")>=0||B.indexOf("image")>=0)&&x.images.indexOf(C)===-1){x.images.push(C)}else{if((B.indexOf("video")>=0)&&x.videoLinks.indexOf(C)===-1){x.videoLinks.push(C)}else{if(D.indexOf("audio/")>=0&&x.audioLinks.indexOf(C)===-1){x.audioLinks.push(C)}}}});A.find("[nodeName='enclosure']").each(function(){var E=e(this);var D=E.attr("type")||"";var B=E.attr("medium")||"";var C=E.attr("url");if((D.indexOf("video/")>=0||B.indexOf("video")>=0)&&x.videoLinks.indexOf(C)===-1){x.videoLinks.push(C)}});A.find("[nodeName='media:thumbnail']").each(function(){x.thumbnail=e(this).attr("url")});t.push(x)})};var i=function(t){if(!t){return""}return escape(t.replace(/\s*/g,""))};var a=function(w,t,v){var u=w.children("entry");if(v&&v>0){u=u.slice(0,v)}u.each(function(y){var z=e(this);var A=o(z.find("published").text());var x={id:z.find("id").text(),title:z.find("title").text(),content:z.find("content").text()||"",summary:z.find("summary").text()||"",category:z.find("category").attr("term"),published:(A)?A.getTime():"",author:{name:z.find("author > name").text(),email:z.find("author > email").text()},articleLink:"",images:[],thumbnail:null,audioLinks:[],videoLinks:[],likeable:true,commentable:"yes"};z.find("link").each(function(){var D=e(this);var C=D.attr("type")||"";var B=D.attr("rel")||"alternate";if(C.indexOf("image/")>=0){x.images.push(D.attr("href"))}else{if((C.indexOf("/html")>=0||!C)&&B==="alternate"){x.articleLink=D.attr("href")||""}}});t.push(x)})};var h=function(t){var u;try{u=new DOMParser().parseFromString(t,"text/xml")}catch(v){u=[]}return u};var o=function(u){var w=u.match(q);if(!w){return}var v=0;var t=new Date(w[1],0,1);if(w[3]){t.setMonth(w[3]-1)}if(w[5]){t.setDate(w[5])}if(w[7]){t.setHours(w[7])}if(w[8]){t.setMinutes(w[8])}if(w[10]){t.setSeconds(w[10])}if(w[12]){t.setMilliseconds(Number("0."+w[12])*1000)}if(w[14]){v=(Number(w[16])*60)+Number(w[17]);v*=((w[15]=="-")?1:-1)}v-=t.getTimezoneOffset();return new Date(Number(t)+v*60*1000)};var q=/([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?/})(jQuery);
ï»¿/*
	Watermark v3.1.1 (January 10, 2011) plugin for jQuery
	http://jquery-watermark.googlecode.com/
	Copyright (c) 2009-2011 Todd Northrop
	http://www.speednet.biz/
	Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(b,j,y){var p="function",k="password",d="maxLength",g="type",a="",c=true,o="placeholder",e=false,w="watermark",l=w,i="watermarkClass",t="watermarkFocus",n="watermarkSubmit",r="watermarkMaxLength",h="watermarkPassword",f="watermarkText",m=/\r/g,v=":data("+l+")",q=":text,:password,:search,textarea",s=["Page_ClientValidate"],u=e,x=o in document.createElement("input");b.watermark=b.watermark||{version:"3.1.1",runOnce:c,options:{className:w,useNative:c,hideBeforeUnload:c},hide:function(a){b(a).filter(v).each(function(){b.watermark._hide(b(this))})},_hide:function(b,q){var o=b[0],p=(o.value||a).replace(m,a),l=b.data(f)||a,n=b.data(r)||0,k=b.data(i);if(l.length&&p==l){o.value=a;if(b.data(h))if((b.attr(g)||a)==="text"){var e=b.data(h)||[],c=b.parent()||[];if(e.length&&c.length){c[0].removeChild(b[0]);c[0].appendChild(e[0]);b=e}}if(n){b.attr(d,n);b.removeData(r)}if(q){b.attr("autocomplete","off");j.setTimeout(function(){b.select()},1)}}k&&b.removeClass(k)},show:function(a){b(a).filter(v).each(function(){b.watermark._show(b(this))})},_show:function(e){var p=e[0],v=(p.value||a).replace(m,a),j=e.data(f)||a,q=e.attr(g)||a,s=e.data(i);if((v.length==0||v==j)&&!e.data(t)){u=c;if(e.data(h))if(q===k){var o=e.data(h)||[],n=e.parent()||[];if(o.length&&n.length){n[0].removeChild(e[0]);n[0].appendChild(o[0]);e=o;e.attr(d,j.length);p=e[0]}}if(q==="text"||q==="search"){var l=e.attr(d)||0;if(l>0&&j.length>l){e.data(r,l);e.attr(d,j.length)}}s&&e.addClass(s);p.value=j}else b.watermark._hide(e)},hideAll:function(){if(u){b.watermark.hide(q);u=e}},showAll:function(){b.watermark.show(q)}};b.fn.watermark=b.fn.watermark||function(s,r){var u="string";if(!this.length)return this;var w=e,v=typeof s===u;if(v)s=s.replace(m,a);if(typeof r==="object"){w=typeof r.className===u;r=b.extend({},b.watermark.options,r)}else if(typeof r===u){w=c;r=b.extend({},b.watermark.options,{className:r})}else r=b.watermark.options;if(typeof r.useNative!==p)r.useNative=r.useNative?function(){return c}:function(){return e};return this.each(function(){var z="dragleave",y="dragenter",B=this,e=b(B);if(!e.is(q))return;if(e.data(l)){if(v||w){b.watermark._hide(e);v&&e.data(f,s);w&&e.data(i,r.className)}}else{if(x&&r.useNative.call(B,e)&&(e.attr("tagName")||a)!=="TEXTAREA"){v&&e.attr(o,s);return}e.data(f,v?s:a);e.data(i,r.className);e.data(l,1);if((e.attr(g)||a)===k){var C=e.wrap("<span>").parent(),p=b(C.html().replace(/type=["']?password["']?/i,'type="text"'));p.data(f,e.data(f));p.data(i,e.data(i));p.data(l,1);p.attr(d,s.length);p.focus(function(){b.watermark._hide(p,c)}).bind(y,function(){b.watermark._hide(p)}).bind("dragend",function(){j.setTimeout(function(){p.blur()},1)});e.blur(function(){b.watermark._show(e)}).bind(z,function(){b.watermark._show(e)});p.data(h,e);e.data(h,p)}else e.focus(function(){e.data(t,1);b.watermark._hide(e,c)}).blur(function(){e.data(t,0);b.watermark._show(e)}).bind(y,function(){b.watermark._hide(e)}).bind(z,function(){b.watermark._show(e)}).bind("dragend",function(){j.setTimeout(function(){b.watermark._show(e)},1)}).bind("drop",function(d){var c=e[0],b=d.originalEvent.dataTransfer.getData("Text");if((c.value||a).replace(m,a).replace(b,a)===e.data(f))c.value=b;e.focus()});if(B.form){var u=B.form,A=b(u);if(!A.data(n)){A.submit(b.watermark.hideAll);if(u.submit){A.data(n,u.submit);u.submit=function(c,a){return function(){var d=a.data(n);b.watermark.hideAll();if(d.apply)d.apply(c,Array.prototype.slice.call(arguments));else d()}}(u,A)}else{A.data(n,1);u.submit=function(a){return function(){b.watermark.hideAll();delete a.submit;a.submit()}}(u)}}}}b.watermark._show(e)})};if(b.watermark.runOnce){b.watermark.runOnce=e;b.extend(b.expr[":"],{search:function(b){return"search"===(b.type||a)},data:function(c,d,a){return!!b.data(c,a[3])}});(function(c){b.fn.val=function(){var d=this;if(!d.length)return arguments.length?d:y;if(!arguments.length)if(d.data(l)){var e=(d[0].value||a).replace(m,a);return e===(d.data(f)||a)?a:e}else return c.apply(d,arguments);else{c.apply(d,arguments);b.watermark.show(d);return d}}})(b.fn.val);s.length&&b(function(){for(var a,c,d=s.length-1;d>=0;d--){a=s[d];c=j[a];if(typeof c===p)j[a]=function(a){return function(){b.watermark.hideAll();return a.apply(null,Array.prototype.slice.call(arguments))}}(c)}});b(j).bind("beforeunload",function(){b.watermark.options.hideBeforeUnload&&b.watermark.hideAll()})}})(jQuery,window);
var focusScreen,loadScreen,reloadScreen,getAbsoluteUrl,getScreenUrl,navigateTo,currentScreen=false,currentScreenLoaded,currentScreenHash,prevScreen,navigateBack,isReload,isBack,params,backButtonHandler,onOrientationChange,initScreenHandler,onResumeApp,screenHistory=[];screenInstanceData={};seScreen={};Screen=function(a){this.jScreen=$(renderEjs("screen_item",{}));this.history=[];this.navigationBar=new NavigationBar(this.jScreen);this.jContent=this.jScreen.find("#content");a.append(this.jScreen);this.activityIndicator=new ActivityIndicator(a);this.screenDataStore={};this.hooks=$("<div></div>");var b=this;$(document).bind("userLogIn userLogOut",function(){if(b.history.length>1){for(var c=b.history.length-2;c>=0;c--){var d=b.history[c];if(d.screenObj){d.screenObj.unload(d.params);delete d.screenObj}if(d.jCanvas){d.jCanvas.empty();delete d.jCanvas}}}});this.hooks.bind("screenLoad",function(c,d){if(!d){b.doShowAds(b.shouldShowAds)}})};Screen.prototype.showToast=function(a){device.call("ui/showToast",{text:a})};Screen.prototype.getPersistantData=function(a,b,d){var e=false;var c=this.screenDataStore;if(!c[a]){if(d){c[a]={};c[a][d]={};e=c[a][d]}else{c[a]={};e=c[a]}}else{if(d){if(!c[a][d]){c[a][d]={}}e=c[a][d]}else{e=c[a]}}$.extend(b,e);$.extend(e,b);return e};Screen.prototype.screenData=function(a){var b=$.extend({stepsBack:0,defaultData:{},compartmentId:undefined},a);var c=this.history[this.history.length-1-b.stepsBack];if(c){return this.getPersistantData(c.hash,b.defaultData,b.compartmentId)}};Screen.prototype.hashChange=function(e){var b=(this.history[this.history.length-1]||{}).hash;var d=(this.history[this.history.length-2]||{}).hash;var a=e;var c=paramsToObject(a.substring(1))||{};if(d==a){this._back()}else{if(b==a){return}else{this.load({hash:a,params:c})}}};Screen.prototype.reload=function(b){if(this.loading){return}network.clearCache();if(this.currentScreen.reload){this.currentScreen.reload()}else{this._clearHistory(1);var a=location.hash;var d=paramsToObject(a.substring(1));if(b&&b.params){var c=d._;d=b.params;d._=c}this.load({hash:a,params:d,isReload:true})}};Screen.prototype.back=function(b,c){var d=$.extend({reload:false,pageYOffset:false},c);this._clearHistory(b-1);if(this.history.length<1){navigateTo("home")}else{var a=this.history[this.history.length-2]||{};if(d.reload){a.reload=true}if(d.pageYOffset!==false){a.scrollYOffset=d.pageYOffset}history.go(b*-1)}};Screen.prototype.markCurrentScreen=function(b){b=b||"mark";var a=this.history[this.history.length-1];if(a){a.mark=b}};Screen.prototype.backToMark=function(a){var e=a.mark||"mark";var c=0;var d=false;for(var b=this.history.length-2;b>=0;b--){c++;if(e===this.history[b].mark){d=true;break}}if(d){this.back(c,a)}else{navigateBack(1,a)}};Screen.prototype._clearHistory=function(b){for(var a=0;a<b;a++){var c=this.history[this.history.length-1];if(!c){break}if(c.screenObj){c.screenObj.willDisappear(c.params,c.jCanvas);c.screenObj.unload(c.params);c.screenObj.didDisappear(c.params);delete c.screenObj}if(c.jCanvas){c.jCanvas.empty()}this.history.pop()}};Screen.prototype._clearResources=function(){this.navigationBar.removeAdditions();this.navigationBar.removeButtons();this.activityIndicator.clear();network.abortRequests()};Screen.prototype._back=function(c){window.scrollTo(0,window.pageYOffset);device.call("ui/hideKeyboard");this.loading=true;this.hooks.trigger("screenLoad",[this.loading]);this._clearHistory(1);var a=this.history[this.history.length-1];if(!a.jCanvas||!a.screenObj||a.reload){a.reload=false;this._clearHistory(1);this.load({isBack:true,hash:a.hash,params:a.params});if(a.scrollYOffset){window.scrollTo(0,a.scrollYOffset)}return}var d=paramsToObject(a.hash.substring(1));var b={params:d,isBack:true,isReload:false,};this._clearResources();this.currentScreen=a.screenObj;a.screenObj.willAppear(b);if(a.screenObj.isCacheable()){a.jCanvas.find(".se-active").removeClass("se-active")}else{a.jCanvas.empty();a.screenObj.load(a.jCanvas,b)}this.jContent.html(a.jCanvas);a.screenObj.didAppear(b,a.jCanvas);if(typeof(a.scrollYOffset)!="undefined"){window.scrollTo(0,a.scrollYOffset);delete a.scrollYOffset}this.loading=false;this.hooks.trigger("screenLoad",[this.loading])};Screen.prototype.doShowAds=function(a){if(shouldShowAdvertisement){var b=ShoutemApp.getModule(ShoutemApp.MODULES.ADS);device.call("ui/advertisement",{show:a,unitId:b.android_unit_code})}};Screen.prototype.showAds=function(a){this.shouldShowAds=a;if(!this.loading){this.doShowAds(a)}};Screen.prototype.load=function(i){this.loading=true;this.hooks.trigger("screenLoad",[this.loading,i]);var d=$.extend({params:{},isBack:false,isReload:false},i);var f=this.history[this.history.length-1];if(!d.isReload&&f&&f.screenObj&&f.jCanvas){if(typeof(f.scrollYOffset)=="undefined"){f.scrollYOffset=window.pageYOffset}f.screenObj.willDisappear(f.params,f.jCanvas);f.jCanvas.detach();f.screenObj.didDisappear(f.params)}this._clearResources();var c={hash:i.hash,params:d.params};this.history.push(c);var e=seScreen["create"+d.params._];if(typeof(e)==="function"){var h=e(d)}else{var b=seScreen[d.params._];var h=new b(d)}this.currentScreen=h;console.debug("Loading screen "+d.params._);this.jContent.empty();this.jContent.html($("<div id='rendered-content'></div>"));var g=this.jContent.find("#rendered-content");window.scrollTo(0,0);device.call("ui/hideKeyboard");var a=h.authentication(d);if(a){h=a;this.authenticationScreenObject=h;h.willAppear(d);h.load(g,d);h.didAppear(d,g)}else{delete this.authenticationScreenObject;h.willAppear(d);h.load(g,d);h.didAppear(d,g);c.screenObj=this.currentScreen;c.jCanvas=g}this.loading=false;this.hooks.trigger("screenLoad",[this.loading,i])};function markCurrentScreen(){se.markCurrentScreen()}function navigateBackToMark(a){se.backToMark(a)}(function(f){f.screen={};var g,a;onOrientationChange=function(h){g=h};function d(){se.hashChange(location.hash)}initScreenHandler=function(){d();if("onhashchange" in window){console.debug("On hashe change set");window.onhashchange=d}else{setInterval(d,600)}};onResumeApp=function(){};var b;getAbsoluteUrl=function(j){if(b===undefined){var h=location.href.indexOf("#");b=h!=-1?location.href.substring(0,h):location.href}var i=b;if(j){i=b.replace(/index\.html/,j)}return i};reloadScreen=function(h){se.reload(h)};getScreenUrl=function(h,i,j){i=i||{};i._=h;return(j?getAbsoluteUrl():"")+"#"+f.param(i)};navigateTo=function(h,j){if(h){var i=h.charAt(0)=="#"?h:getScreenUrl(h,j);location.hash=i}};navigateBack=function(h,i){se.back(h,i)};var c="onorientationchange" in window,e=c?"orientationchange":"resize";f(window).bind(e,function(){if(g){if(a){clearTimeout(a)}a=setTimeout(g,300)}})})(jQuery);
