var Tea={};Tea.encrypt=function(c,r){if(c.length==0){return("")}var s=Tea.strToLongs(Utf8.encode(c));if(s.length<=1){s[1]=0}var g=Tea.strToLongs(Utf8.encode(r).slice(0,16));var d=s.length;var j=s[d-1],l=s[0],o=2654435769;var m,i,a=Math.floor(6+52/d),h=0;while(a-->0){h+=o;i=h>>>2&3;for(var b=0;b<d;b++){l=s[(b+1)%d];m=(j>>>5^l<<2)+(l>>>3^j<<4)^(h^l)+(g[b&3^i]^j);j=s[b]+=m}}var f=Tea.longsToStr(s);return Base64.encode(f)};Tea.decrypt=function(f,r){if(f.length==0){return("")}var s=Tea.strToLongs(Base64.decode(f));var g=Tea.strToLongs(Utf8.encode(r).slice(0,16));var d=s.length;var j=s[d-1],l=s[0],o=2654435769;var m,i,a=Math.floor(6+52/d),h=a*o;while(h!=0){i=h>>>2&3;for(var c=d-1;c>=0;c--){j=s[c>0?c-1:d-1];m=(j>>>5^l<<2)+(l>>>3^j<<4)^(h^l)+(g[c&3^i]^j);l=s[c]-=m}h-=o}var b=Tea.longsToStr(s);b=b.replace(/\0+$/,"");return Utf8.decode(b)};Tea.strToLongs=function(c){var a=new Array(Math.ceil(c.length/4));for(var b=0;b<a.length;b++){a[b]=c.charCodeAt(b*4)+(c.charCodeAt(b*4+1)<<8)+(c.charCodeAt(b*4+2)<<16)+(c.charCodeAt(b*4+3)<<24)}return a};Tea.longsToStr=function(c){var b=new Array(c.length);for(var d=0;d<c.length;d++){b[d]=String.fromCharCode(c[d]&255,c[d]>>>8&255,c[d]>>>16&255,c[d]>>>24&255)}return b.join("")};var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Base64.encode=function(n,p){p=(typeof p=="undefined")?false:p;var g,b,a,r,o,k,j,h,i=[],f="",m,q,l;var d=Base64.code;q=p?Utf8.encode(n):n;m=q.length%3;if(m>0){while(m++<3){f+="=";q+="\0"}}for(m=0;m<q.length;m+=3){g=q.charCodeAt(m);b=q.charCodeAt(m+1);a=q.charCodeAt(m+2);r=g<<16|b<<8|a;o=r>>18&63;k=r>>12&63;j=r>>6&63;h=r&63;i[m/3]=d.charAt(o)+d.charAt(k)+d.charAt(j)+d.charAt(h)}l=i.join("");l=l.slice(0,l.length-f.length)+f;return l};Base64.decode=function(n,e){e=(typeof e=="undefined")?false:e;var g,b,a,o,k,i,h,q,j=[],p,m;var f=Base64.code;m=e?Utf8.decode(n):n;for(var l=0;l<m.length;l+=4){o=f.indexOf(m.charAt(l));k=f.indexOf(m.charAt(l+1));i=f.indexOf(m.charAt(l+2));h=f.indexOf(m.charAt(l+3));q=o<<18|k<<12|i<<6|h;g=q>>>16&255;b=q>>>8&255;a=q&255;j[l/4]=String.fromCharCode(g,b,a);if(h==64){j[l/4]=String.fromCharCode(g,b)}if(i==64){j[l/4]=String.fromCharCode(g)}}p=j.join("");return e?Utf8.decode(p):p};var Utf8={};Utf8.encode=function(a){var b=a.replace(/[\u0080-\u07ff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(192|d>>6,128|d&63)});b=b.replace(/[\u0800-\uffff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(224|d>>12,128|d>>6&63,128|d&63)});return b};Utf8.decode=function(b){var a=b.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var d=((e.charCodeAt(0)&15)<<12)|((e.charCodeAt(1)&63)<<6)|(e.charCodeAt(2)&63);return String.fromCharCode(d)});a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var d=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(d)});return a};
sePages={};var createPage=function(d,a){var c="create"+d.type;if(typeof(window[c])=="function"){return window[c](d,a)}else{var b=sePages[d.type];if(typeof(b)=="function"){return new b(d,a)}}};var unloadPage=function(b){var a="unload"+b.type;if(typeof(window[a])=="function"){window[a](b)}};var createInfoBar=function(a,j){var e={segments:[{text:j.info1Text,icon:j.info1Icon},{text:j.info2Text,icon:j.info2Icon},{text:j.info3Text,icon:j.info3Icon}],infoBarType:j.infoBarType};var c=[];if(e.infoBarType&&typeof(e.infoBarType)=="string"){var g=e.infoBarType.replace(/^(.*)?Segments(.*)/i,"$1Segments|$2").split("|");var h=g[0];var b=g[1]}switch(h){case"ThreeSegments":a.addClass("se-three-column-grid");e.segments=e.segments.slice(0,3);break;case"TwoSegments":e.segments=e.segments.slice(0,2);a.addClass("se-two-column-grid");break;default:a.addClass("se-three-column-grid");e.segments=e.segments.slice(0,3);break}var k=false;for(var d=0;d<e.segments.length;d++){var f=e.segments[d];if(f.icon&&f.text){k=true;break}}if(!k){return false}switch(b){case"Wide":a.addClass("se-wide");break;case"Short":a.addClass("se-short");break}$.each(e.segments,function(m,o){if(typeof(o.text)=="number"&&!o.text){o.text="0"}var n=$(renderEjs("info_bar_column",o));c.push(n);if(o.icon&&o.text){var l=o.icon.replace(/\w+_(\w+)_(\w+).*/,"se-$1-icon-$2");n.find(".se-icon").addClass(l).addClass("se-icon-left");n.addClass("se-icon-left")}else{n.find(".se-icon").remove()}});c[0].addClass("se-first-column");c[c.length-1].addClass("se-last-column");$.each(c,function(l,m){a.append(m)});return true};var createActivityItem=function(c,a){var b=$(renderEjs("activity_feed_item",{feedItem:c}));createInfoBar(b.find(".se-info-bar-grid"),c);if(c.showSeparator){b.addClass("se-show-separator")}return b};var createItemElement=function(c,b){var a=$(renderEjs(b,{feedItem:c}));createInfoBar(a.find(".se-info-bar-grid"),c);if(c.showSeparator){a.addClass("se-show-separator")}return a};var createPlacesElement=function(b,a){b.info1Text=b.info1Text||b.infoText;b.info1Icon=b.info1Icon||b.infoImage;return createItemElement(b,a)};var getFromObjectList=function(d,b,c){for(var a=0;a<d.length;a++){if(d[a][b]+""===c+""){return d[a]}}return false};var createPageItemFactory=function(a){return{createItemElement:function(b,c){var f=b.schema_uuid;if(!c){c=getFromObjectList(a,"schema_uuid",f)||a[0]}var e=Binding.createObject({bindDesc:c.bindings,bindEnv:{context:b}});if(c.bindings.visibilityBinding&&!e.visibilityBinding){return $("")}if(c.type==="CommentItem"){var d=createItemElement(e,"comment_item")}else{if(c.type==="ActivityItem"){var d=createActivityItem(e,c)}else{if(c.type==="SmallDisclosureItem"){var d=createItemElement(e,"small_disclosure_item")}else{if(c.type==="NewsItem"){var d=createItemElement(e,"news_feed_item")}else{if(c.type==="DealsItem"){var d=createItemElement(e,"deals_feed_item")}else{if(c.type==="PodcastItem"){var d=createItemElement(e,"podcasts_feed_item")}else{if(c.type==="CategoryItem"){var d=createItemElement(e,"categories_feed_item")}else{if(c.type==="CalendarItem"){var d=createItemElement(e,"events_feed_item")}else{if(c.type==="SimpleItem"&&c.style=="peopleItem"){var d=createItemElement(e,"people_feed_item")}else{if(c.type==="SimpleItem"&&c.style=="placeItem"){var d=createPlacesElement(e,"places_feed_item")}else{var d=createItemElement(e,"news_feed_item")}}}}}}}}}}if(c.action){d.touchEvents();d.bind("fastClick click",function(){executeAction(c.action,b)})}return d}}};
sePages.PhotosPage=function(a){this.page=a;this.dataSource=ShoutemApp.getDatasourceByRef(a.dataSource);this.listFeedProvider=DataSourceListFeedProvider.instance(this.dataSource)};classExtend(sePages.PhotosPage,ScreenBase);sePages.PhotosPage.prototype.willAppear=function(a){if(a.params.detailed_view){se.navigationBar.hide();setAndroidOptionsMenu(null,true)}else{se.navigationBar.show();refreshNavigationBarButton.attachTo(se.navigationBar,{position:"prepend"});setAndroidOptionsMenu()}};sePages.PhotosPage.prototype.didDisappear=function(a){setAndroidOptionsMenu()};sePages.PhotosPage.prototype.load=function(p,q){var i=this.page;var e=q.params;var b=this.dataSource;var n=this.listFeedProvider;var j=function(){var r=$(renderEjs("load_message_item",{}));p.html(r)};if(e.detailed_view){p.append(renderEjs("gallery_detail",{}));var g=p.find("#image");var a=p.find("#description");var m=p.find("#count");var l=g.parent();var o=p.find("#previous");var k=p.find("#next");var f=$(window).height();l.css({height:f});var c=function(v){v=v.data;var r=[];$.each(v,function(z,x){var y=i.items[0];var A=Binding.createObject({bindDesc:y.bindings,bindEnv:{context:x}});r.push(A)});var w=parseInt(e.select_index,10)||0;var u=function(z){w=z;var B=r[w];if(g.is(":visible")){g.hide();l.addClass("img-loading")}else{l.removeClass("img-loading");g.show()}if(w===0){o.find(".se-btn-text").addClass("se-dissabled")}else{o.find(".se-btn-text").removeClass("se-dissabled")}if(w>=r.length-1){k.find(".se-btn-text").addClass("se-dissabled")}else{k.find(".se-btn-text").removeClass("se-dissabled")}m.html((w+1)+"/"+r.length);a.html(B.title);if(!B.imageUrl){l.removeClass("img-loading");l.addClass("img-loading-failed")}else{l.removeClass("img-loading-failed");g.attr("src",B.imageUrl)}var x=v[w];var A=x.schema_uuid;var y=getFromObjectList(i.items,"schema",A)||i.items[0];var B=Binding.createObject({bindDesc:y.bindings,bindEnv:{context:x}});p.find("#details").unbind("click").bind("click",function(){executeAction(y.action,x)});g.unbind("click").bind("click",function(){executeAction(y.action,x)})};u(w);var t=function(x){if(w>0){u(w-1)}};var s=function(x){if(w<r.length-1){u(w+1)}};l.swipe({threshold:{x:10,y:10},swipeRight:t,swipeLeft:s});p.find("#previous").click(t);p.find("#next").click(s)}}else{p.append(renderEjs("gallery_page",{}));var h=p.find("#gallery-list");var c=function(u){u=u.data;var t=$(window).width();var s=3;var r=(t)/s;$.each(u,function(y,v){var x=i.items[0];var z=Binding.createObject({bindDesc:x.bindings,bindEnv:{context:v}});z.width=r;z.height=r;var w=$(renderEjs("gallery_item",{feedItem:z}));if((y%s)===(s-1)){w.addClass("se-last-column")}w.click(function(){e.page=i.id;e.detailed_view=true;e.select_index=y;navigateTo(e._,e)});h.append(w)})}}var d=n.find({fromCache:true});if(d&&!isReload){c(d)}else{n.find({offset:0,limit:30,success:function(r){c(r)},error:j,})}};
sePages.DetailsPage=function(a){this.page=a;this.dataSource=ShoutemApp.getDatasourceByRef(this.page.dataSource);this.authServer=getAuthServerForDataSource(this.dataSource);this.newsProvider=DataSourceListFeedProvider.instance(this.dataSource);this.newsLikesProvider=shoutem.providers.newsLikesProviderFactory.createFromDataSource(this.dataSource);this.newsCommentsProvider=shoutem.providers.newsCommentsProviderFactory.createFromDataSource(this.dataSource)};classExtend(sePages.DetailsPage,ScreenBase);sePages.DetailsPage.prototype.didAppear=function(b,a){se.showAds(true)};sePages.DetailsPage.prototype.willDisappear=function(b,a){removeAdvertisement(a);setAndroidOptionsMenu()};sePages.DetailsPage.prototype.willAppear=function(b,a){se.navigationBar.show();if(this.viewItem){var d=this.viewItem;if(d.commentable){var c=new NavigationBarButton({icon:"img/icon_comment.png",onClick:function(){createNewsComment()}});c.attachTo(se.navigationBar,{position:"append"})}if(d.articleLink){var c=new NavigationBarButton({icon:"img/icon_share.png",onClick:function(){shareNewsArticleLink()}});c.attachTo(se.navigationBar,{position:"append"})}if(typeof(this.isLiked)!=="undefined"&&d.likeable){var c=new NavigationBarButton({icon:this.isLiked?"img/icon_unlike.png":"img/icon_like.png",onClick:function(){toggleNewsLike()}});c.attachTo(se.navigationBar,{position:"prepend"})}setNewsArticleOptionsMenu(d,false)}};sePages.DetailsPage.prototype._toggleNewsLike=function(){var b=this.newsLikesProvider;var a=this;requireAuthentication(function(){var c=function(){se.showToast(a.isLiked?M.unlike:M.like);reloadScreen()};if(a.isLiked){b.unlike({articleId:a.item.id,success:c,error:function(e,d){if(e.status==200){c()}}})}else{b.like({articleId:a.item.id,success:c})}},{},a.authServer,true)};sePages.DetailsPage.prototype._shareNewsArticleLink=function(){var b=this.viewItem.articleLink;var a=this.viewItem;shortenUrl(b,function(d){var c=140-(d||b).length;var e={title:M.share,text:shorten(a.title||M.shareNewsText,c),sharedUrl:d||b};device.call("ui/showShareMenu",e)})};sePages.DetailsPage.prototype._createNewsComment=function(){var b=this.authServer;var c=this.item;if(c){var d=(c.commentable==="yes"&&!user.authenticated(b));var a=c.anonymous_contact_data_allowed;navigateTo(getNewsCommentUrl(c.id,null,b,d,a,null,null,this.dataSource.id))}};sePages.DetailsPage.prototype._onNewsCommentComplete=function(){if(this.item){this.item.comments_count++}};sePages.DetailsPage.prototype.__deleteNewsComment=function(a){var b=this.item;this.newsCommentsProvider.remove({commentId:a,articleId:b.id,success:function(){b.comments_count=Math.max(0,b.comments_count-1);reloadScreen()},error:function(){reloadScreen()}})};sePages.DetailsPage.prototype._deleteNewsComment=function(b){if(!this.item){return}if(device.platform=="native"){var a={title:M.remove,text:M.deleteCommentMessage,options:[{label:M.yes,url:"javascript:se.currentScreen.__deleteNewsComment('"+b+"')"},{label:M.cancel,url:""}]};device.call("ui/showDialog",a)}else{if(confirm(M.deleteCommentMessage)){se.currentScreen.__deleteNewsComment(b)}}};sePages.DetailsPage.prototype.load=function(l,m){var f=m.params;var h=this.page;var a=this.dataSource;var n=DataSourceListFeedProvider.instance(a);var k=this.newsLikesProvider;var b=this.newsCommentsProvider;var i=f.itemId;var g=this;var e=function(H){H.id=H.post_id||H.event_id;var x=createPageItemFactory(h.customItems);var B=Binding.createObject({bindDesc:h.bindings,bindEnv:{context:H}});g.bItem=B;g.item=H;var u=H.likeable||H.likable;var A={};g.viewItem=A;A.id=H.id;A.title=B.title;if(H.attachments&&H.attachments.images){A.text=insertImageAttachments(B.body,H.attachments.images,null)}else{A.text=B.body}A.published=H.published;A.commentable=H.commentable&&H.commentable!=="no";A.likeable=u&&u!=="no";A.show_media_border=true;A.show_buttons=device.platform!=="native";A.bItem=B;var r=A.articleLink=H.articleLink||H.link;if(H.fb_commentable=="yes"){A.fbArticleLink=A.articleLink}else{A.fbArticleLink=false}var G=$(renderEjs("article_page",A));if(A.fbArticleLink){loadFBJSSDK(network.facebookAppId)}createInfoBar(G.find(".se-info-bar-grid"),B);var t=A;var v=G.find("#newsTextContainer > .text");var I=A.barcodeimageurl;if(I){$("<div class='bannerImgBorder'><img src='"+I+"' class='medium'></img></div>").prependTo(v)}var y=B.readOriginalUrl;if(y){$("<a></a>",{href:y,text:M.readWholeArticle}).appendTo(v).wrap("<p></p>")}v.find("a").attr("target","_blank").click(openExternalLink);var D=G.find("#custom-items");if(h.customItems){$.each(h.customItems,function(N,O){var L=createComponent(O,H,H,g.authServer,g.dataSource);if(L){L.willAppear(m);L.load(D,m);L.didAppear(m)}})}var q=G.find(".mediaBorder");if(H.attachments&&H.attachments.videos&&H.attachments.videos.length>0){var F=H.attachments.videos[0];var o=getVideoImageUrl(F);if("theme/img/audio-play.png"===o&&H.attachments.images.length>0){o=H.attachments.images[0].src}var E=ui.contentSize().width-44;var s=getVideoUrl(F.src);q.html(renderEjs("video_preview",{isEmbedded:canPlayEmbeddedVideo(s),useIframe:false,width:E,height:Math.round(E*3/4),videoUrl:s,imageUrl:o}))}else{if(B.leadAudioUrl){var C=document.createElement("audio");if(C.canPlayType("audio/mpeg")){var K=B.leadAudioUrl.replace(/^https:/i,"http:");jPlayer=$(renderEjs("audio_player_item",{feedItem:{title:B.title,audio_url:K}}));new AudioPlayer(jPlayer);q.html(jPlayer)}else{q.html(renderEjs("audio_preview",{is_embedded:false,audio_url:B.leadAudioUrl}))}}else{if(B.leadImageUrl){var w=Math.min(B.leadImageWidth,$(window).width()-44);var J=B.leadImageHeight/B.leadImageWidth*w;var z=$("<div style='max-width: 100%; margin: 0 auto 0 auto;' class='se-box-shadow se-avatar-border se-crop se-btn-corner-all'><img class='se-cropable img-loading' src='"+B.leadImageUrl+"' onLoad='cropImage(event);' onError='seImageLoadError(event)'></img></div>");z.css({width:w,height:J});q.html(z)}}}onOrientationChange(function(){var L=ui.contentSize().width-32;$(".videoPlayerContainer, .videoPlayerContainer embed").attr({width:L,height:Math.round(L*3/4)})});toggleNewsLike=function(){g._toggleNewsLike()};shareNewsArticleLink=function(){g._shareNewsArticleLink()};createNewsComment=function(){g._createNewsComment()};onNewsCommentComplete=function(){g._onNewsCommentComplete()};onNewsCommentLogin=function(){navigateTo(getLoginUrl())};l.append(G);if(t.commentable){var p=new NavigationBarButton({icon:"img/icon_comment.png",onClick:function(){createNewsComment()}});p.attachTo(se.navigationBar,{position:"append"})}if(t.articleLink){var p=new NavigationBarButton({icon:"img/icon_share.png",onClick:function(){shareNewsArticleLink()}});p.attachTo(se.navigationBar,{position:"append"})}if(A.likeable){k.get({articleId:H.id,inBackground:true,success:function(O){var N=g.authServer;var L=user.identities.findIdentity(N);var Q=isUserLiked(L?L.userId:false,O.data);g.isLiked=Q;if(t.likeable){var P=new NavigationBarButton({icon:Q?"img/icon_unlike.png":"img/icon_like.png",onClick:function(){toggleNewsLike()}});P.attachTo(se.navigationBar,{position:"prepend"})}setNewsArticleOptionsMenu(A,Q);l.find("#newsLikes").html(getLikeLabel(O)).show();if(!O.data||O.data.length===0){l.find("#newsLikes").unbind("click").one("click",toggleNewsLike)}l.find("#newsLikeButton").click(toggleNewsLike).html(Q?M.unlike:M.like)},error:$.noop})}else{g.isLiked=false;if(t.likeable){var p=new NavigationBarButton({icon:"img/icon_like.png",onClick:function(){toggleNewsLike()}});p.attachTo(se.navigationBar,{position:"prepend"})}setNewsArticleOptionsMenu(A,false)}if(A.commentable){this.commentsComponent=new seComponents.CommentsComponent({article:H,commentsProvider:b,itemFactory:createPageItemFactory(h.items)});this.commentsComponent.load(l.find("#comments"),m)}if(A.commentable){l.find("#newsCommentButton").click(createNewsComment)}else{l.find("#newsCommentButton").hide()}showAdvertisementOnBottom(l)};var c=function(p,o){if(p.status==0){ui.error(M.youAreOffline)}navigateBack(1)};var j={postId:i,success:e,error:c,};j.fromCache=true;var d=this.newsProvider.get(j);if(d){e(d)}else{j.fromCache=false;this.newsProvider.get(j)}};
