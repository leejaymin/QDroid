branding=(function(){return{doBranding:function(g,a){var i=function(j){if(j==="Regular"){return"normal"}return"normal"};var h=function(j){return parseInt(j,16)};var b=function(j){if(j.match(/^[0-9a-fA-F]{8}$/)){return h(j.substring(0,2))/255}return 1};var f=function(j){if(j.match(/^[0-9a-fA-F]{6}$/)){return"#"+j.substring(0,6)}else{if(j.match(/^[0-9a-fA-F]{8}$/)){return"rgba("+h(j.substring(2,4))+", "+h(j.substring(4,6))+", "+h(j.substring(6,8))+", "+(h(j.substring(0,2))/255)+")"}else{if(j.match(/^#([0-9a-fA-F]{6})$/)){return j.substring(0,7)}}}return j};branding={network_logo_url:"theme/img/ShoutEm.png",light_sublabel_color:"#969696"};$.extend(branding,g.skin);var d;d=(".imgShoutEmLogo { background-image: url("+branding.network_logo_url+"); } h1,.boxAnnounce > *, .feedPosts .icon, .feedItems .icon, .board .arrow, .newsArticle .title { background-color: "+branding.theme_color+"; visibility: visible  } a, em, h2, h3, .grpLinks a, .feed .content .nick, #homeIconSwitcher .selected { color: "+branding.theme_color+"; visibility: visible } h4 { color: "+branding.light_sublabel_color+"; } ");var e=getFromObjectList(g.modules,"type","HomeScreenGrid");if(e){branding.shortcut_font=e.shortcut_font||{family:"Helvetica",style:"Regular",size:14};branding.notifications_bar_color=e.notifications_bar_color||"#c9c9c9";branding.notifications_bar_text_color=e.notifications_bar_text_color||"#ffffff";branding.pager_deselected_color=e.pager_deselected_color||"#ffffff";branding.pager_selected_color=e.pager_selected_color||"#000000";branding.buttons_panel_color=e.buttons_panel_color||"#FFD3D3D3";d+=(".label {"+(e.text_color?("color: "+f(e.text_color)+";"):"")+'font-family: "'+branding.shortcut_font.family+'";font-style: '+i(branding.shortcut_font.style)+";font-size: "+branding.shortcut_font.size+"px;}#statusBar {background-color: "+f(branding.notifications_bar_color)+";}#statusBar a {color: "+f(branding.notifications_bar_text_color)+";}#homeIconSwitcher span {color: "+f(branding.pager_deselected_color)+";}#homeIconSwitcher .selected {color: "+f(branding.pager_selected_color)+";}")}evalCss(d);var c=function(j){var k=renderEjs(j,g);evalCss(k);a()};$.ajax({url:"theme/styling.css",async:false,success:c})}}})();
shoutem=window.shoutem||{providers:{}};function arrayMergeAppend(g,d,b){if(d.length===0){return g.slice(0)}var f=d[0][b].toString();var a=false;for(var c=0;c<g.length;c++){var e=g[c][b].toString();if(f==e){a=g.slice(0,c);break}}if(!a){a=g.slice(0)}return a.concat(d)}shoutem.providers.cache=(function(){var c=function(d){return{val:d,cachedAt:(new Date()).getTime()}};var a=function(f,e){if(!f){return null}if(typeof f!=="object"){return null}if(!f.val){return null}var d=new Date().getTime();if(e.cacheExpireTimeout>0&&d-f.cachedAt>e.cacheExpireTimeout){return null}return f.val};var b=function(d){return d};return{executeAndCache:function(f,h,e,d){var g=d.success;d.success=function(i){f.set(h,i);(g||$.noop)(i)};e(d)},CompositeCache:function(d){var e={caches:d};this.set=function(f,g){$.each(e.caches,function(j,h){h.put(f,g)})};this.get=function(g){var f,h;for(f=0;f<e.caches.length;f++){h=e.caches[f].get(g);if(h){return h}}return null};this.clear=function(){$.each(e.caches,function(g,f){f.clear()})}},MemoryCache:function(f){var e={cacheExpireTimeout:-1};$.extend(e,f);var d={};this.set=function(g,h){d[b(g)]=c(h)};this.get=function(g){var h=d[b(g)];return a(h,e)};this.remove=function(g){var h=b(g);if(d[h]){delete d[h]}};this.clear=function(){d={}}},DBCache:function(e){var d={uniqueId:"",cacheExpireTimeout:-1};$.extend(d,e);d.uniqueId=b(d.uniqueId);this.set=function(f,h){if(device.platform_name==="native_android"){return}var g=DB.get(d.uniqueId);if(g&&(typeof(g)=="object")){g[f]=c(h)}else{g={key:c(h)}}DB.set(d.uniqueId,g)};this.get=function(f){var g=DB.get(d.uniqueId);if(!g||(typeof(g)!="object")){return null}var h=g[f];return a(h,d)};this.clear=function(){DB.set(d.uniqueId,null)}}}})();
DataSourceListFeedProvider=(function(){var a={instance:function(d){var c;if(d.type=="InlineDataSource"){c={statusObject:$("<div></div>"),find:function(e){var f={data:d.data,paging:{next:null,previous:null}};if(e.fromCache){return f}(e.success||$.noop)(f)},get:function(e){var f=d.data;if(e.fromCache){return f[0]}(e.success||$.noop)(f[0])}}}else{if(d.type=="CustomDataSource"){return d.createListProvider(d.parameters)}else{var b=getAuthServerForDataSource(d);return new ShoutemApiNewsProvider({categoryId:d.parameters.category_id,apiUrl:d.endpointUrl,authServer:b,methodPrefix:d.parameters.method_prefix,idName:d.idName,idParam:d.parameters.id_param})}}return c}};return a})();
shoutem.providers.newsLikesProviderFactory={create:function(a){if(a.type=="WebFeed"||a.type=="ShoutemNetwork"){return new shoutem.providers.ShoutemNetworkNewsLikesProvider()}else{return new shoutem.providers.ShoutemApiNewsLikesProvider({apiUrl:a.url,authServer:a.authServer})}},createFromDataSource:function(a){return new shoutem.providers.ShoutemApiNewsLikesProvider({apiUrl:a.endpointUrl,authServer:getAuthServerForDataSource(a)})}};shoutem.providers.ShoutemApiNewsLikesProvider=function(b){var c=$("<div></div>");var a=new shoutem.services.ServiceClient({url:b.apiUrl,appendTypeToUrl:false,methodParameterName:"method",authServer:b.authServer,status:c});this.statusObject=c;this.get=function(d){a.GET("posts/likes",{post_id:d.articleId},d.success,d.error,null,null,{inBackground:d.inBackground})};this.like=function(d){a.POST("posts/likes/new",{post_id:d.articleId},d.success,d.error)};this.unlike=function(d){a.POST("posts/likes/delete",{post_id:d.articleId},d.success,d.error)}};shoutem.providers.ShoutemNetworkNewsLikesProvider=function(b){var c=$("<div></div>");var a=new shoutem.services.ServiceClient({url:b.apiUrl,authServer:"ShoutemNetwork",status:c});this.statusObject=c;this.find=function(d){a.GET("news_likes/url_summary",{url_id:d.articleId},d.success,d.error,false,null,{inBackground:d.inBackground})};this.create=function(d){network.addNewsLike(d.articleId,d.articleUrl,d.success,d.error)};this.remove=function(d){network.deleteNewsLike(d.articleId,d.likeId,d.success,d.error)};this.get=function(d){};this.like=function(d){};this.unlike=function(d){}};
shoutem=window.shoutem||{providers:{}};shoutem.providers.EventsProviderFactory=(function(){var a={create:function(b){return shoutem.providers.EventsProvider.New(b.rss_url)}};return a})();shoutem=window.shoutem||{providers:{}};shoutem.providers.EventsProvider=(function(){var a={p:{eventsCache:new shoutem.providers.cache.MemoryCache({cacheExpireTimeout:24*60*60*1000}),remapEvent:function(b){return b}},instance:function(c){var d=$("<div></div>");var b={p:{eventProviderUrl:c,client:new shoutem.services.ServiceClient({url:c,appendTypeToUrl:false,methodParameterName:"method",authServer:c,status:d})}};b.statusObject=d;b.p.doFindEvents=function(e){e.params=e.params||{};var f=function(g){e.success(g)};b.p.client.GET("events/find",{category_id:e.categoryId,offset:e.offset,limit:e.limit},f,e.error,false,null,{inBackground:e.inBackground})};b.find=function(e){assert(e.categoryId);var f=b.p.eventProviderUrl+e.categoryId;if(e.fromCache){return a.p.eventsCache.get(f)}shoutem.providers.cache.executeAndCache(a.p.eventsCache,f,b.p.doFindEvents,e)};b.findNext=function(e){assert(e.categoryId);var g=b.p.eventProviderUrl+e.categoryId;var f=a.p.eventsCache.get(g);b.p.client.GET(e.next,{},function(h){if(f){f.paging.next=h.paging.next;f.data=arrayMergeAppend(f.data,h.data,"post_id")}(e.success||$.noop)(h)},e.error,false,{},{inBackground:e.inBackground,absoluteUrl:true})};b.p.doGetEvent=function(e){var f=function(g){e.success(a.p.remapEvent(g))};b.p.client.GET("events/get",{category_id:e.categoryId,event_id:e.postId,post_id:e.post_id},f,e.error,false,null,{inBackground:e.inBackground})};ShoutemApiNewsProvider.prototype.findNext=function(e){var g=this.apiUrl+e.categoryId;var f=ShoutemApiNewsProvider.newsCache.get(g);this.api.GET(e.next,{},function(j){var h=[];for(var k=0;k<j.data.length;k++){h.push(parseFeedItem(j.data[k]))}j.data=h;if(f){f.paging.next=j.paging.next;f.data=f.data.concat(j.data)}(e.success||$.noop)(j)},e.error,null,{},{inBackground:e.inBackground,absoluteUrl:true})};b.get=function(e){var g=b.p.eventProviderUrl+e.categoryId;if(e.fromCache){var f=a.p.eventsCache.get(g);if(f&&f.data){return getFromObjectList(f.data,"post_id",e.postId)}return false}b.p.doGetEvent(e)};return b},New:function(b){return a.instance(b)}};$(document).bind("userLogIn",function(){a.p.eventsCache.clear()});$(document).bind("userLogOut",function(){a.p.eventsCache.clear()});return a})();
shoutem.providers.authenticationProviderFactory={create:function(a){if(a.type=="ShoutemNetwork"){console.debug("Creating network authentication provider");return new shoutem.providers.ShoutemNetworkAuthenticationProvider()}else{console.debug("Creating api authentication provider for "+a.type);return new shoutem.providers.ShoutemApiAuthenticationProvider({apiUrl:a.type})}}};shoutem.providers.ShoutemApiAuthenticationProvider=function(b){var a=new shoutem.services.ServiceClient({url:b.apiUrl,appendTypeToUrl:false,methodParameterName:"method"});this.authenticate=function(c){var d={};a.POST("users/authenticate",{username:c.username,password:c.password},function(e){c.success({authType:"url",sessionId:e.session_id,userId:e.user_id})},c.error,false,d)}};shoutem.providers.ShoutemNetworkAuthenticationProvider=function(a){this.authenticate=function(b){var c;if(b.sessionId){c=b.sessionId}else{if(b.username&&b.password){c=createAuth(b.username,b.password)}}if(!b.username&&!b.password&&!b.sessionId){b.error();return}var d=ShoutemApp.getModule(ShoutemApp.MODULES.COMMUNITY);var e=d&&d.community_type==="ning";if(e){if(!b.username&&!b.password){network.verifyUser(b.userId,{authenticated:true,authType:"url",sessionId:b.sessionId},function(f){b.success({userId:f.id,sessionId:b.sessionId,authType:"url"})},b.error)}else{network.verifyNingCredentials(b.username,b.password,function(f){b.success({authType:"url",sessionId:f.session_id,userId:f.user.id})},b.error)}return}if(c){network.verifyNetworkCredentials(c,function(f){network.authenticateWith(c?c:false);b.success({authType:"basic",sessionId:c,userId:f.id})},b.error)}else{network.getUserInfo(null,function(f){b.success({userId:f.id})},b.error)}}};
shoutem.providers.newsProviderFactory={createFromDataSource:function(a){return new ShoutemApiNewsProvider({apiUrl:a.endpointUrl,authServer:getAuthServerForDataSource(a)})}};ShoutemApiNewsProvider=function(a){this.statusObject=$("<div></div>");this.categoryId=a.categoryId;this.apiUrl=a.apiUrl;this.hostUrl=getHostAddress(a.apiUrl);this.methodPrefix=a.methodPrefix||"posts";this.idName=a.idName||"post_id";this.idParam=a.idParam||"post_id";this.query="";this.api=new shoutem.services.ServiceClient({url:a.apiUrl,appendTypeToUrl:false,methodParameterName:"method",authServer:a.authServer,status:this.statusObject})};(function(){ShoutemApiNewsProvider.newsCache=new shoutem.providers.cache.MemoryCache({uniqueId:"API_NEWS_PROVIDER_CACHE",cacheExpireTimeout:24*60*60*1000});$(document).bind("userLogIn",function(){ShoutemApiNewsProvider.newsCache.clear()});$(document).bind("userLogOut",function(){ShoutemApiNewsProvider.newsCache.clear()})})();function parseFeedItem(a){a.id=a.post_id;a.thumbnail=a.image_url;a.attachments=a.attachments||{};if(!a.summary){a.summary=textifyHtml(a.description||a.body||"")}if(a.summary.length>160){a.summary=a.summary.substring(0,160)+"..."}return a}ShoutemApiNewsProvider.prototype.doFindNews=function(a){var e;var d;if(currentGeoPosition.coords.latitude&&currentGeoPosition.coords.longitude){e=currentGeoPosition.coords.latitude;d=currentGeoPosition.coords.longitude}var b=this;var c=this.query;a=$.extend({categoryId:this.categoryId},a);this.api.GET(this.methodPrefix+"/find",{session_id:a.sessionId,category_id:a.categoryId,limit:a.limit,offset:a.offset,latitude:e,longitude:d,query:this.query,radius:config.radius},function(g){var f=[];for(var h=0;h<g.data.length;h++){f.push(parseFeedItem(g.data[h]))}g.data=f;g.query=c;(a.success||$.noop)(g);b.statusObject.trigger("findSuccess",[g,a])},function(g,f){(a.error||$.noop)(g,f);b.statusObject.trigger("findError",[g,f])},null,null,{inBackground:a.inBackground})};ShoutemApiNewsProvider.prototype.findNext=function(a){a=$.extend({categoryId:this.categoryId},a);var e=this.apiUrl+this.methodPrefix+a.categoryId;var b=ShoutemApiNewsProvider.newsCache.get(e);var d=this.query;var c=this;this.api.GET(toAbsoluteUrl(a.next,this.hostUrl),{},function(g){if(c.query!=d){return}if(!g||!g.data){(a.error||$.noop)();return}var f=[];for(var h=0;h<g.data.length;h++){f.push(parseFeedItem(g.data[h]))}g.data=f;if(b){b.paging.next=g.paging.next;b.data=arrayMergeAppend(b.data,g.data,c.idName)}(a.success||$.noop)(g);c.statusObject.trigger("findNextSuccess",[g,a])},function(g,f){(a.error||$.noop)(g,f);c.statusObject.trigger("findNextError",[g,f])},null,{},{inBackground:a.inBackground,absoluteUrl:true})};ShoutemApiNewsProvider.prototype.find=function(a){a=$.extend({categoryId:this.categoryId},a);var d=this.apiUrl+this.methodPrefix+a.categoryId;if(a.fromCache){var b=ShoutemApiNewsProvider.newsCache.get(d);if(b&&b.query!=this.query){return false}return b}var c=this;shoutem.providers.cache.executeAndCache(ShoutemApiNewsProvider.newsCache,d,function(e){c.doFindNews(e)},a)};ShoutemApiNewsProvider.prototype.setQuery=function(a){if(this.query!=a){this.query=a;return true}return false};ShoutemApiNewsProvider.prototype.doGetNews=function(a){var b={session_id:a.sessionId,};b[this.idParam+""]=a.postId;b.category_id=a.categoryId;this.api.GET(this.methodPrefix+"/get",b,function(c){(a.success||$.noop)(parseFeedItem(c))},a.error,false,null,{inBackground:a.inBackground})};ShoutemApiNewsProvider.prototype.get=function(a){a=$.extend({categoryId:this.categoryId},a);var c=this.apiUrl+this.methodPrefix+a.categoryId;if(a.fromCache){var b=ShoutemApiNewsProvider.newsCache.get(c);if(b&&b.data){return getFromObjectList(b.data,this.idName,a.postId)}return false}this.doGetNews(a)};
shoutem.providers.couponsProviderFactory={createFromDataSource:function(a){return new ShoutemApiCouponsProvider({apiUrl:a.endpointUrl,authServer:getAuthServerForDataSource(a)})}};ShoutemApiCouponsProvider=function(a){this.statusObject=$("<div></div>");this.apiUrl=a.apiUrl;this.hostUrl=getHostAddress(a.apiUrl);this.methodPrefix=a.methodPrefix||"coupons";this.idParam=a.idName||"post_id";this.query="";this.api=new shoutem.services.ServiceClient({url:a.apiUrl,appendTypeToUrl:false,methodParameterName:"method",authServer:a.authServer,status:this.statusObject})};ShoutemApiCouponsProvider.prototype.request=function(d,a){var b=$.extend({success:$.noop,error:undefined,postId:undefined},a);var c={};c[this.idParam]=b.postId;this.api.GET(this.methodPrefix+"/"+d,c,b.success,b.error,false,null,{inBackground:a.inBackground})};ShoutemApiCouponsProvider.prototype.get=function(a){this.request("get",a)};ShoutemApiCouponsProvider.prototype.save=function(a){this.request("save",a)};
shoutem.providers.newsCommentsProviderFactory={create:function(a){if(a.type=="WebFeed"||a.type=="ShoutemNetwork"){console.debug("CREATING SHOUTEM NETWORK COMMENTS PROVIDER FOR "+a.type);return new shoutem.providers.ShoutemNetworkNewsCommentsProvider()}else{console.debug("CREATING SHOUTEM API COMMENTS PROVIDER FOR "+a.url);return new shoutem.providers.ShoutemApiNewsCommentsProvider({apiUrl:a.url,authServer:a.authServer})}},createFromDataSource:function(a){return new shoutem.providers.ShoutemApiNewsCommentsProvider({apiUrl:a.endpointUrl,authServer:getAuthServerForDataSource(a),methodPrefix:a.parameters.method_prefix,idParam:a.parameters.id_param||"post_id"})}};shoutem.providers.ShoutemApiNewsCommentsProvider=function(c){var d=$("<div></div>");var b=new shoutem.services.ServiceClient({url:c.apiUrl,appendTypeToUrl:false,methodParameterName:"method",authServer:c.authServer,status:d});this.stateObject=d;function a(f,g){g(f)}function e(f){return{id:f.comment_id,publisher:{screen_name:f.author,id:f.author_id,profile_image_url:f.author_image_url},created_at:new Date(f.published_at).getTime(),text:f.message}}this.find=function(f){var g={session_id:f.sessionId,offset:f.offset,limit:f.limit};g[c.idParam]=f.articleId;b.GET(c.methodPrefix+"/comments",g,function(h){if(h.data){a(h.data,f.success)}else{(f.error||$.noop)()}},f.error,null,null,{inBackground:f.inBackground})};this.create=function(f){var g={session_id:user.sessionId,author_nickname:f.author,author_email:f.authorEmail,author_url:f.authorUrl,message:f.text};g[c.idParam]=f.articleId;b.POST(c.methodPrefix+"/comments/new",g,f.success,f.error)};this.remove=function(f){var g={session_id:user.sessionId,comment_id:f.commentId,};g[c.idParam]=f.articleId;b.POST(c.methodPrefix+"/comments/delete",g,f.success,f.error)}};shoutem.providers.ShoutemNetworkNewsCommentsProvider=function(b){var c=$("<div></div>");var a=new shoutem.services.ServiceClient({url:b.apiUrl,authServer:"ShoutemNetwork",state:stateObject});this.statusObject=c;this.find=function(d){a.GET("news_comments/collection",{url_id:d.articleId},d.success,d.error,false,null,{inBackground:d.inBackground})};this.create=function(d){network.addNewsComment(d.articleId,d.articleUrl,d.text,d.createShout,d.success,d.error)};this.remove=function(d){network.deleteNewsComment(d.articleId,d.commentId,d.success,d.error)}};
seScreen.tabstrip_categories=function(a){var c=ShoutemApp.getPageByRef({"$ref":a.params.pageId});this.title=c.title;var b={id:c.id+"_tabs_page",type:"ListPage",hideRefresh:true,dataSource:{id:c.id+"_tabs",type:"InlineDataSource",data:c.tabs},items:[{type:"CategoryItem",bindings:{title:{path:"title"},tabId:{path:"id"}},action:{type:"DelegateAction",delegate:function(d){executeAction({type:"OpenPageAction",page:{"$ref":c.id},parameters:{activeTab:d.activeTab,hideCategories:true,showBack:true}})},parameters:{activeTab:{path:"id"}}}}]};this.page=createPage(b)};seScreen.tabstrip_categories.prototype=new ScreenBase();seScreen.tabstrip_categories.constructor=ScreenBase;seScreen.tabstrip_categories.prototype.parent=ScreenBase.prototype;seScreen.tabstrip_categories.prototype.willAppear=function(c){var a=[{label:M.home,url:"javascript:goToHomeScreen();",icon:"img/android/home.png"}];device.call("ui/setOptionsMenu",{items:a});this.setTitle(M.categories);var b=new NavigationBarButton({icon:"img/icon_back.png",onClick:function(){navigateBack(1)}});b.attachTo(se.navigationBar);this.page.willAppear(c)};seScreen.tabstrip_categories.prototype.didAppear=function(){se.showAds(false)};seScreen.tabstrip_categories.prototype.load=function(b,a){b.html($(renderEjs("generic_screen",{})));this.page.load(b.find("#generic_content"),a)};seScreen.tabstrip_categories.prototype.unload=function(){setAndroidOptionsMenu()};
seScreen.createGenericScreen=function(b){var d=ShoutemApp.getPageByRef({"$ref":b.params.page});var a=createPage(d,b);var c=a.load;a.load=function(f,e){var g=this;requireGeoPosition(function(){c.call(g,f,e)})};return a};
