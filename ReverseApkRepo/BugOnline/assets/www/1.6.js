sePages.MapPage=function(b,a){this.page=b;this.dataSource=ShoutemApp.getDatasourceByRef(this.page.dataSource);this.markers=[];var c=a.params;if(c.longitude&&c.latitude){this.singleItemMap=true;this.includeCurrentPositionInCentering=true}};classExtend(sePages.MapPage,ScreenBase);sePages.MapPage.prototype.willAppear=function(b){se.navigationBar.show();var c=b.params;if(!c.hideRefresh){refreshNavigationBarButton.attachTo(se.navigationBar,{position:"prepend"})}if(c.showBack){var a=new NavigationBarButton({icon:"img/icon_back.png",onClick:function(){navigateBack(1)}});a.attachTo(se.navigationBar)}};sePages.MapPage.prototype.didAppear=function(a){if(this.listFeedProvider&&this.map){var b=this.listFeedProvider.find({fromCache:true});if(b){this.renderMarkers(this.map,b)}}};sePages.MapPage.prototype.renderMarkers=function(f,e){e=e.data;var h=ShoutemApp.getModule("Places")||{};var d=this;var a=[];var g=[];$.each(e,function(m,j){var l=d.page.items[0];var n=Binding.createObject({bindDesc:l.bindings,bindEnv:{context:j}});if(n.longitude&&n.latitude){var o={longitude:n.longitude,latitude:n.latitude};a.push(o);var k=addMarkerToGoogleMap(f,n.latitude,n.longitude,n.pinUrl||h.map_pin_small_image_url,n.title,function(){if(!d.singleItemMap){executeAction(l.action,j)}else{navigateBack(1)}});g.push(k)}});if(this.includeCurrentPositionInCentering){a.push({longitude:currentGeoPosition.coords.longitude,latitude:currentGeoPosition.coords.latitude})}for(var c=0;c<this.markers.length;c++){var b=this.markers[c];b.setMap(null)}this.markers.length=0;this.markers=g;if(g.length===0){se.showToast(M.noResults)}setTimeout(function(){centerMap(f,a)},0)};sePages.MapPage.prototype.load=function(b,a){if(this.map){delete this.map}var d=a.params;var c=this;MapComponent.create({mapLoaded:function(k){var f=false;c.map=k;if(c.singleItemMap){c.renderMarkers(k,{data:[{name:d.name,geo:{coordinates:[d.latitude,d.longitude]}}]});return}if(c.parentPage&&c.parentPage.tabPages){var j=false;for(var g=0;g<c.parentPage.tabPages.length;g++){var e=c.parentPage.tabPages[g].page;if(e.listFeedProvider){f=e.listFeedProvider;break}}}if(!f){f=DataSourceListFeedProvider.instance(c.dataSource)}c.listFeedProvider=f;if(a.isReload){f.find({success:function(i){renderMarkers(k,i)},error:$.noop,})}else{var h=f.find({fromCache:true});if(h){c.renderMarkers(k,h)}else{f.find({success:function(i){c.renderMarkers(k,i)},error:$.noop,})}}}},b)};
var createTabbedPage=function(c,b){var a=ShoutemApp.getPageByRef(c.tabs[0].page);if(a&&a.type=="WebPage"){return createUrlFeedPage(c,b)}if(c.tabBarType=="Strip"){return new sePages.TabStripPage(c,b)}else{return new sePages.SegmentedTabPage(c,b)}};sePages.TabStripPage=function(c,a){this.page=c;this.tabs=c.tabs;this.cacheable=true;var b=this;this.screenData=se.screenData();if(a.isReload&&typeof(this.screenData.stripActiveTabId)!="undefined"){this.activeTabId=this.screenData.stripActiveTabId}else{this.screenData.stripActiveTabId=undefined}this.onCategorySelected=function(e,d){if(b.activeTabId!=d){b.activeTabId=d;b.cacheable=false;b.screenData.stripActiveTabId=d}}};classExtend(sePages.TabStripPage,ScreenBase);sePages.TabStripPage.prototype.isCacheable=function(){if(!this.cacheable){this.cacheable=true;return false}return true};sePages.TabStripPage.prototype.unload=function(){$(document).unbind("categorySelected",this.onCategorySelected)};sePages.TabStripPage.prototype.willDisappear=function(b,a){if(this.activeTabPage){this.activeTabPage.willDisappear(b,a)}};sePages.TabStripPage.prototype.didDisappear=function(a){if(this.activeTabPage){this.activeTabPage.didDisappear(a)}};sePages.TabStripPage.prototype.willAppear=function(e){$(document).unbind("categorySelected",this.onCategorySelected);se.navigationBar.show();var h=e.params;if(!this.activeTabId){this.activeTabId=h.activeTab||this.tabs[0].id}var a=this.activeTabId;this.activeTab=getFromObjectList(this.tabs,"id",a)||this.tabs[0];if(h.showBack){var d=new NavigationBarButton({icon:"img/icon_back.png",onClick:function(){navigateBack(1)}});d.attachTo(se.navigationBar)}if(this.tabs.length>1&&!h.hideCategories){var c=this.page.id;var f=this;var d=new NavigationBarButton({title:M.categories,icon:"img/filter.png",onClick:function(){$(document).one("categorySelected",f.onCategorySelected);navigateTo(getScreenUrl("tabstrip_categories",{pageId:c,scrollPosition:"delete"}))}});d.attachTo(se.navigationBar)}if(this.activeTab.title){var b=$(renderEjs("title_bar_item",{title:this.activeTab.title}));se.navigationBar.addAddition(b,25)}var g=ShoutemApp.getPageByRef(this.activeTab.page);if(this.activeTabPage&&this.activeTabPage.page.id===g.id){this.activeTabPage.willAppear(e)}else{this.activeTabPage=createPage(g,e);this.activeTabPage.willAppear(e)}};sePages.TabStripPage.prototype.didAppear=function(b,a){if(this.activeTabPage){this.activeTabPage.didAppear(b,a)}};sePages.TabStripPage.prototype.load=function(b,a){this.activeTabPage.load(b,a)};sePages.SegmentedTabPage=function(e,b){if(!e){return}this.page=e;this.tabs=e.tabs;this.tabPages=[];for(var c=0;c<this.tabs.length;c++){var d=this.tabs[c];var a=createPage(ShoutemApp.getPageByRef(d.page),b);a.parentPage=this;this.tabPages.push({page:a,loaded:false})}};classExtend(sePages.SegmentedTabPage,ScreenBase);sePages.SegmentedTabPage.prototype.willAppear=function(a){if(this.currentTabPage){this.currentTabPage.page.willAppear(a)}};sePages.SegmentedTabPage.prototype.didAppear=function(b,a){if(this.currentTabPage){this.currentTabPage.page.didAppear(b,this.currentTabPage.jTabAnchor)}};sePages.SegmentedTabPage.prototype.willDisappear=function(b,a){if(this.currentTabPage){this.currentTabPage.page.willDisappear(b,this.currentTabPage.jTabAnchor)}};sePages.SegmentedTabPage.prototype.didDisappear=function(a){if(this.currentTabPage){this.currentTabPage.page.didDisappear(a)}};sePages.SegmentedTabPage.prototype.load=function(b,a){var c=[];var d=this;$.each(this.tabs,function(e,f){c.push({id:f.id,title:f.title,select:function(h,i){var g=d.tabPages[e];if(d.currentTabPage){d.currentTabPage.page.willDisappear(a,d.currentTabPage.jTabAnchor);d.currentTabPage.page.didDisappear()}d.currentTabPage=g;g.page.willAppear(a);if(!g.loaded){g.page.load(i,a);g.loaded=true;g.jTabAnchor=i}g.page.didAppear(a,i)}})});TabsComponent.create({tabs:c,activeTab:a.params.activeTab||0},b)};var createUrlFeedPage=function(d,b){var a=[];$.each(d.tabs,function(e,f){a.push({title:f.title,url:f.parameters.url})});var c={id:d.id+"_tabs_page",type:"ListPage",hideRefresh:true,dataSource:{id:d.id+"_tabs",type:"InlineDataSource",data:a},items:[{type:"CategoryItem",bindings:{title:{path:"title"},url:{path:"url"}},action:{type:"DelegateAction",delegate:function(e){openExternalLink(null,e.url)},parameters:{url:{path:"url"}}}}]};return createPage(c,b)};
function _onGoogleMapsApiLoaded(){_requireGoogleMapsApi.complete();delete _requireGoogleMapsApi.complete;_requireGoogleMapsApi.loaded=true}function _requireGoogleMapsApi(a,c){if(_requireGoogleMapsApi.loaded){a();return}else{_requireGoogleMapsApi.complete=a;var b=document.createElement("script");b.type="text/javascript";b.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=_onGoogleMapsApiLoaded";document.body.appendChild(b);setTimeout(function(){if(!_requireGoogleMapsApi.loaded){se.activityIndicator.hide()(c||$.noop)()}},7000)}}function _createGoogleMap(b,a,c){se.activityIndicator.show();_requireGoogleMapsApi(function(){var d=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);var i=d;var f={zoom:15,center:i,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:false,mapTypeControl:false,navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.ANDROID},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM}};var h=new google.maps.Map(c.get(0),f);var g;g=google.maps.event.addListener(h,"tilesloaded",function(){se.activityIndicator.hide();google.maps.event.removeListener(g)});var e=new google.maps.Marker({position:d});e.setMap(h);b(h)})}var MapComponent=(function(){var a={create:function(d,b){if(isBack){window.scrollTo(0,0)}b.empty();var c=$("<div id='mapCanvas'></div>");requireGeoPosition(function(){setTimeout(function(){var f=c.position().top;var e=$(window).height()-f;c.css("height",e+"px");_createGoogleMap(d.mapLoaded,currentGeoPosition,c)},500)},function(){ui.error(M.youAreOffline)});b.append(c)}};return a})();
NavigationBarButton=function(a){this.settings=$.extend({title:"",id:false,icon:false,onClick:$.noop},a);if(!this.settings.id){this.settings.id=this.settings.title+":"+this.settings.icon}this.id=this.settings.id};NavigationBarButton.prototype.attachTo=function(b,a){b.addButton(this,a)};NavigationBarButton.prototype.jHtml=function(){var a=$(renderEjs("navigation_bar_button",this.settings));a.touchEvents().bind("click fastClick",this.settings.onClick);return a};
RefreshNavigationBarButton=function(){this.constructor.call(this,{id:"refresh",icon:"img/refresh_icon.png",onClick:function(){reloadScreen()}})};RefreshNavigationBarButton.prototype=new NavigationBarButton();RefreshNavigationBarButton.constructor=NavigationBarButton;RefreshNavigationBarButton.prototype.parent=NavigationBarButton.prototype;
NavigationBar=function(a){this.jAnchor=a;this.jAdditions=a.find("#additions");this.jAdditionsSpacer=a.find("#additions-spacer");this.jRightButtonList=a.find(".right-btn-list");this.jVisibleElements=a.find("#top-toolbar, #top-toolbar-spacer, #header");a.find(".home-button").touchEvents().bind("click fastClick",function(){goToHomeScreen()});this.events=$("<div></div>");this.buttons=[]};NavigationBar.prototype.addAddition=function(c,a){this.jAdditions.append(c);var b=$("<div style='background: black;'></div>");b.css({height:a+"px"});this.jAdditionsSpacer.append(b)};NavigationBar.prototype.removeAdditions=function(){this.jAdditions.empty();this.jAdditionsSpacer.empty()};NavigationBar.prototype.removeButtons=function(){this.events.trigger("navigationBarButtonsRemoved");this.jRightButtonList.empty();this.buttons.length=0};NavigationBar.prototype.getButtonById=function(a){return getFromObjectList(this.buttons,"id",a)};NavigationBar.prototype.addButton=function(d,a){var e=$.extend({position:"prepend"},a);var c=this.getButtonById(d.id);if(c){return false}var b=d.jHtml();if(e.position=="prepend"){this.buttons.unshift(d);this.jRightButtonList.prepend(b)}else{this.buttons.push(d);this.jRightButtonList.append(b)}return true};NavigationBar.prototype.hide=function(){this.jVisibleElements.hide();this.shown=false};NavigationBar.prototype.show=function(){if(!this.shown){this.jVisibleElements.show()}this.shown=true};
ActivityIndicator=function(a){this.jIndicator=a.find("#activityIndicator");this.count=0;this.visible=false};ActivityIndicator.prototype.show=function(){this.count++;if(this.visible){return}if(device.platform==="native"){device.call("ui/showActivityIndicator",{visible:true})}else{var a=window.pageYOffset+($(window).height()/2)-$("#activityIndicator").height();this.jIndicator.css("top",a+"px").show();this.jIndicator.show()}};ActivityIndicator.prototype.hide=function(){this.count=Math.max(0,this.count-1);if(this.count===0){this.visible=false;if(device.platform==="native"){device.call("ui/showActivityIndicator",{visible:false})}else{this.jIndicator.hide()}}};ActivityIndicator.prototype.clear=function(){this.count=0;this.hide()};
Carousel=function(a){this.jContainer=a;this.container=a.get(0);this.jInnerHolder=this.jContainer;this.jPanel=this.jContainer.find(".se-content-panel");this.panel=this.jContainer.find(".se-content-panel").get(0);this.groupCount=this.panel.childElementCount;this.jPrevious=a.find(".se-left-button");this.jNext=a.find(".se-right-button");this.overlay=this.container;this.overlay.addEventListener("click",this,true);this.overlay.addEventListener("mouseup",this,false);this.overlay.addEventListener("mousedown",this,false);this.overlay.addEventListener("touchstart",this,false);this.overlay.addEventListener("touchout",this,false);this.overlay.addEventListener("touchend",this,false);this.overlay.addEventListener("touchcancel",this,false);this.currentPage=0;this.panelOffsetX=0;this.touchStartX=false;this.setButtons(0);var b=this;this.jPrevious.click(function(){var c=b.jInnerHolder.outerWidth();b.moveTo(b.panelOffsetX+c)});this.jNext.click(function(){var c=b.jInnerHolder.outerWidth();b.moveTo(b.panelOffsetX-c)})};Carousel.prototype.getOffsetX=function(c,a){if(c.touches&&c.touches.length>0){var d=c.touches[0];for(var b=0;b<c.touches.length;b++){if(c.touches[b].identifier=a){d=c.touches[b];break}}return d.screenX}else{return c.pageX}};Carousel.prototype.setButtons=function(d){var a=false;var b=false;if(this.groupCount>1&&d<0){a=true}var c=this.jInnerHolder.outerWidth();if(this.groupCount>1&&(d>-(this.groupCount-1)*c||d===0)){b=true}if(a){if(!this.jPrevious.hasClass("active")){this.jPrevious.addClass("active")}}else{this.jPrevious.removeClass("active")}if(b){if(!this.jNext.hasClass("active")){this.jNext.addClass("active")}}else{this.jNext.removeClass("active")}};Carousel.prototype.moveToPage=function(b){var a=this.jInnerHolder.outerWidth();this.moveTo(-Math.abs(b)*a);delete this.currentPanelOffsetX};Carousel.prototype.moveTo=function(c){var b=this.jInnerHolder.outerWidth();var a=Math.max(Math.round(-c/b),0);this.setButtons(c);this.currentPanelOffsetX=c;this.jPanel.addClass("se-animate");this.jPanel.css({"-webkit-transform":"translate3d("+this.currentPanelOffsetX+"px,0,0)"});this.panelOffsetX=this.currentPanelOffsetX;if(this.currentPage!==a){console.debug("Event pageChange: "+a);this.jContainer.trigger("pageChange",[a])}this.currentPage=a};Carousel.prototype.handleEvent=function(a){var c=a.type;console.debug(a.type);switch(c){case"mousedown":case"touchstart":a.preventDefault();this.jPanel.removeClass("se-animate");if(a.touches&&a.touches.length>0){var e=a.touches[0];this.touchStartX=e.screenX;this.touchIdentifier=e.identifier;this.container.addEventListener("touchmove",this,true)}else{this.touchStartX=this.getOffsetX(a);this.container.addEventListener("mousemove",this,true)}break;case"click":if(!this.allowPropagation){console.debug("Propagation stopped");a.stopPropagation()}break;case"mouseup":case"touchout":case"touchend":console.debug("Offset change Final: "+this.panelOffsetChange+" currentPanelOffsetX "+this.currentPanelOffsetX);if(this.panelOffsetChange&&Math.abs(this.panelOffsetChange)>20){if(this.panelOffsetChange<0){var d=this.currentPage-1}else{var d=this.currentPage+1}if(d>=0&&d<this.groupCount){this.moveToPage(d)}else{this.moveToPage(this.currentPage)}}else{if(this.currentPanelOffsetX&&!isNaN(this.currentPanelOffsetX)){var b=this.jInnerHolder.outerWidth();var i=Math.round(b/3);var h=Math.max(-b*(this.groupCount-1),Math.min(0,Math.round((this.currentPanelOffsetX)/b)*b));this.moveTo(h)}else{this.allowPropagation=true;var g=this;setTimeout(function(){g.allowPropagation=false},500)}}delete this.currentPanelOffsetX;case"touchcancel":this.container.removeEventListener("touchmove",this,true);this.container.removeEventListener("mousemove",this,true);delete this.touchIdentifier;delete this.panelOffsetChange;break;case"mousemove":case"touchmove":if(!this.touchStartX){this.touchStartX=this.getOffsetX(a,this.touchIdentifier)}var f=this.getOffsetX(a,this.touchIdentifier);var j=this.currentPanelOffsetX||this.panelOffsetX;this.currentPanelOffsetX=f-this.touchStartX+this.panelOffsetX;this.panelOffsetChange=(j-this.currentPanelOffsetX);console.debug("Offset change: "+this.panelOffsetChange);this.panel.style.webkitTransform="translate3d("+this.currentPanelOffsetX+"px,0,0)";break}};
var TabsComponent=(function(){var a={create:function(g,b){var f={activeTab:0};var c=g.tabs;var h=$(renderEjs("tabs_component",{}));var e=h.find(".tabLinks");var d=100/c.length;$.each(c,function(l,m){var j=$('<li style="width:'+d+'%"><div class="link" id="'+l+'">'+m.title+"</div></li>");var k=$('<div id="'+l+'"class="tabContent"></div>');var n=function(){m.select(m,k);f.activeTab=l;h.find(".tabLinks .selected, .tabContent.selected").removeClass("selected");h.find("#"+l).addClass("selected")};j.find(".link").touchEvents().bind("fastClick click",function(){var i=$(this).attr("class");if(i.indexOf("selected")!=-1){return}n()});h.append(k);e.append(j);if(l===f.activeTab||m.id===f.activeTab){n()}});b.append(h)}};return a})();
seComponents.ListComponent=function(a){this.settings=$.extend({itemsPerPage:15,hasSearch:false,listProvider:undefined,itemFactory:undefined},a)};classExtend(seComponents.ListComponent,ComponentBase);seComponents.ListComponent.prototype.load=function(p,q){var f=this.settings.itemsPerPage;var o=this.settings.listProvider;var k=this.settings.itemFactory;jListComponent=$(renderEjs("list_component",{}));p.html(jListComponent);var i=p.find("#loadMoreButtonContainer");var n=p.find("#loadMoreButtonContainer");var j=p.find("#newsFeedLoadMessage");i.touchEvents();var e=jListComponent.find("#search-form");var d=e.find(".se-search-input");var c=function(s,r){window.scrollTo(0,0);p.find("#newsFeed").empty();if(s.status==0){j.html("<p>"+M.youAreOffline+"</p>").show()}else{j.html("<p>"+M.newsLoadErrorMessage+"</p>").show()}};var b=function(){window.scrollTo(0,0);p.find("#newsFeed").empty();p.find("#newsFeedLoadMessage").html("<p>"+M.noResults+"</p>").show()};var l=function(x,r,t){var u=x.paging.next;x=x.data;if(!r&&(!x||x.length===0)){b();return}if(u){n.show();i.unbind("click fastClick").bind("click fastClick",function(){n.hide();o.findNext({next:u})})}else{n.hide()}var s=[];$.each(x,function(z,A){s.push(k.createItemElement(A))});var w=function(A,z){$.each(z,function(B,C){A.append(C)})};var v=p.find("#newsFeed");var y=v.parent();v.detach();if(!r){v.empty()}w(v,s);y.prepend(v)};var h=p.find("#loading-indicator");h.hide();o.statusObject.unbind(".listComponent");o.statusObject.bind("apiAjaxStart.listComponent",function(s,r){s.stopPropagation();if(!r){h.show()}});o.statusObject.bind("apiAjaxComplete.listComponent",function(s,r){s.stopPropagation();if(!r){h.hide()}});o.statusObject.bind("findSuccess.listComponent",function(t,s,r){l(s,false,r)});o.statusObject.bind("findError.listComponent",function(s,t,r){c(t,r)});o.statusObject.bind("findNextSuccess.listComponent",function(t,s,r){l(s,true,r)});o.statusObject.bind("findNextError.listComponent",function(s,t,r){n.show()});var a=this.settings.hasSearch;if(a){jListComponent.find(".se-search-li").show()}if(a){var m=function(){var r=d.val();if(o.setQuery(r)){j.empty().hide();p.find("#newsFeed").empty();n.hide();o.find({offset:0,limit:f})}};e.submit(function(r){r.preventDefault();m()});e.find(".se-search-icon").unbind("click").bind("click",m)}var g=o.find({fromCache:true});if(g&&!q.isReload){l(g,false)}else{window.scrollTo(0,0);o.find({offset:0,limit:f})}};
