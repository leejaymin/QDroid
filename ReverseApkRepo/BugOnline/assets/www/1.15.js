function onVerificationError(e,a){var c;if(params.fbRedirect){c="Facebook"}if(params.twRedirect){c="Twitter"}if(e===undefined){ui.error(getMessage("failedConnectingToAccount",c))}else{if(e.status==409){var d;try{d=JSON.parse(e.responseText).error}catch(b){d=getMessage("failedConnectingToAccount",c)}ui.error(d)}if(e.status==500){ui.error(getMessage("failedConnectingToAccount",c))}else{onErrorResponse(e,a)}}}function getDirectionsUrl(c,d){var a=currentGeoPosition.coords.longitude;var b=currentGeoPosition.coords.latitude;return"http://maps.google.com/maps?saddr="+b+","+a+"&daddr="+c+","+d}function imageUrl(a){if(a){a=a.replace(/bundle:\/\//,"theme/images/")}return a}function shouldShowAdvertisement(){var a=ShoutemApp.getModule(ShoutemApp.MODULES.ADS);return !device.isNativeIPhone()&&a&&a.android_unit_code}function removeAdvertisement(a){se.showAds(false);if(a){a.find(".se-advertisement-holder").remove()}}function showAdvertisementOnBottom(a){if(!shouldShowAdvertisement()){return}if(!a){a=$("#renderedContent")}se.showAds(true);a.find(".se-advertisement-holder").remove();a.append("<div class='se-advertisement-holder'></div>")}var authenticateUser=function(c,b,a,d){c.identities.set({authServer:b,userId:a.user.id,sessionId:a.session_id,authType:"url"});setAndroidOptionsMenu();se.activityIndicator.hide();(d||$.noop)()};function onExternalServiceConnect(h,g,b,c,e){var f=function(i){user.identities.set({authServer:"ShoutemNetwork",userId:i.user.id,});user.save();setAndroidOptionsMenu();g()};if(!h){(c||$.noop)()}if(h.fbRedirect){if(h.session_key){network.verifyFacebookCredentials(h.session_key,true,f,b)}else{(b||$.noop)()}}else{if(h.twRedirect){if(h.oauth_token&&h.oauth_verifier){if(e){var a=function(i){authenticateUser(window.user,"ShoutemNetwork",i,function(){alert(M.twitterConnectSuccessfulRedirect);navigateTo(getHomeUrl());console.debug("Authenticated user")})};var d=function(j,i){(i||$.noop)(j,i)};network.verifyTwitterCredentials(h.oauth_token,h.oauth_verifier,false,function(i){if(i.twitter_session_key){termsOfServiceAccepted=function(j){if(j){network.verifyTwitterCredentialsWithSessionKey(i.twitter_session_key,true,a,d)}else{d()}};showTermsOfServiceDialog()}else{a(i)}},d)}else{network.associateTwitterCredentialsWithCurrentUser(h.oauth_token,h.oauth_verifier,g,b)}}else{(b||$.noop)()}}else{(c||$.noop)()}}}function getAuthServerForDataSource(a){if(!a.endpointUrl){return"ShoutemNetwork"}if(a.endpointUrl.indexOf("blog.shoutem.com")>=0){return a.endpointUrl}if(a.endpointUrl.indexOf("aperfector.com")>=0||a.endpointUrl.indexOf("shoutem.com")>=0){return"ShoutemNetwork"}return a.endpointUrl}function getAuthServerForFeed(a){switch(a.provider_type){case"ShoutemNingApi":case"WebFeed":return"ShoutemNetwork";case"ShoutemWordpressApi":if(a.rss_url.indexOf("aperfector.com")>=0||a.rss_url.indexOf("shoutem.com")>=0){return"ShoutemNetwork"}return a.rss_url}return"ShoutemNetwork"}function textifyHtml(a){a=a.replace(/<br.*?>/gi,"\n");return a.replace(/<\/?[^>]+(>|$)/g,"")}function centerMap(c,g){if(g.length===0){return}else{if(g.length===1){var f=g[0];var h={longitude:f.longitude,latitude:f.latitude};var j=2}else{var h={longitude:0,latitude:0};var j=0;for(var d=0;d<g.length;d++){var f=g[d];h.longitude+=parseFloat(f.longitude);h.latitude+=parseFloat(f.latitude)}h.longitude=h.longitude/g.length;h.latitude=h.latitude/g.length;for(var d=0;d<g.length;d++){var f=g[d];var b=Geocal.distance(h.latitude,h.longitude,parseFloat(f.latitude),parseFloat(f.longitude));if(j<b){j=b}}}}if(h&&j){var e=new google.maps.LatLng(h.latitude,h.longitude);var a=new google.maps.Circle({radius:j*1000,center:e});c.fitBounds(a.getBounds())}}function navigateToTwitterConnect(a){ui.hideActivityIndicator();if(device.platform==="native"&&device.name==="android"){console.debug("Authorize using native android api");var c="";if(a){c="twitterConnectLogin"}else{c="twitterConnectAssociateWithCurrentUser"}device.call("ui/showTwitterDialog",{networkHost:network.subdomain+".shoutem.com",callback:c});return}else{function b(){var g;var f=$.extend({loginUser:a?true:false},cloneAllExcept(params,["session_key","oauth_token","oauth_verifier","twRedirect","fbRedirect"]),{twRedirect:true});var e=network.subdomain+".shoutem.com";var d="network_login";if(device.scriptOrigin=="local"){g="http://"+e+"/m/redirect.html#"+encodeURIComponent(getScreenUrl(d,f))}else{g=getScreenUrl(d,f,true).replace("_splash","")}return"http://"+e+"/pages/connect/TwitterAuth.aspx?rurl="+encodeURIComponent(g)}location.href=b()}}function twitterConnectAssociateWithCurrentUser(b,a){network.associateTwitterCredentialsWithCurrentUser(b,a,function(){reloadScreen()},function(d,c){onVerificationError(d,c)})}function twitterConnectLogin(b,d){console.debug("Twitter connect is done");var a=function(e){authenticateUser(window.user,"ShoutemNetwork",e,function(){if(se.authenticationScreenObject){reloadScreen()}else{navigateBack(1)}console.debug("Authenticated user")})};var c=function(){alert("Something went wrong with authentication")};network.verifyTwitterCredentials(b,d,false,function(e){if(e.twitter_session_key){termsOfServiceAccepted=function(f){if(f){network.verifyTwitterCredentialsWithSessionKey(e.twitter_session_key,true,a,c)}else{(c||$.noop)()}};showTermsOfServiceDialog()}else{a(e)}},c)}termsOfServiceAccepted=function(a){alert("TOS accepted "+a)};showTermsOfServiceDialog=function(){network.termsOfService(function(c){var b=user.authenticated("ShoutemNetwork");if(!c.tos||b){termsOfServiceAccepted(true)}else{var a={title:"Terms of service",text:textifyHtml(c.tos),options:[{label:M.agree,url:"javascript:termsOfServiceAccepted(true)"},{label:M.disagree,url:"javascript:termsOfServiceAccepted(false)"}]};device.call("ui/showDialog",a)}},function(b,a){if(b.status==0){ui.error(M.youAreOffline);navigateBack(1)}else{termsOfServiceAccepted(false)}})};function facebookConnectAssociateWithCurrentUser(a){network.associateFacebookAccessTokenWithCurrentUser(a,function(){reloadScreen()},function(c,b){onVerificationError(c,b)})}function facebookConnectLogin(b){console.debug("Facebook connect is done");var a=function(c){authenticateUser(window.user,"ShoutemNetwork",c,function(){if(se.authenticationScreenObject){reloadScreen()}else{navigateBack(1)}console.debug("Authenticated user")})};network.verifyFacebookAccessToken(b,false,a,function(){termsOfServiceAccepted=function(c){if(c){network.verifyFacebookAccessToken(b,true,a,function(){alert("Something went wrong with authentication")})}};showTermsOfServiceDialog()})}function navigateToFacebookConnect(c){se.activityIndicator.hide();console.debug("Navigate to facebook connect");if(device.platform==="native"&&device.name==="android"){console.debug("Authorize using native android api");var d="";if(c){d="facebookConnectLogin"}else{d="facebookConnectAssociateWithCurrentUser"}device.call("ui/showFacebookDialog",{appId:network.facebookAppId,callback:d});return}function a(){var e=$.extend({},cloneAllExcept(params,["session_key","oauth_token","oauth_verifier","twRedirect","fbRedirect"]),{fbRedirect:true});var f;if(device.scriptOrigin=="local"){f="http://"+network.host_name+"/m/redirect.html#"+encodeURIComponent(getScreenUrl(currentScreen,e))}else{f=getScreenUrl(currentScreen,e,true).replace("_splash","")}return"http://"+network.host_name+"/pages/connect/Facebook.aspx?rurl="+encodeURIComponent(f)+"&scope=publish_stream&display=touch"}var b="http://m.facebook.com/logout.php?confirm=1";openInBackground(b);setTimeout(function(){location.href=a()},1500)}var currentGeoPosition;function requireGeoPosition(c,a,b){c=c||$.noop;if(b||secondsHadPassed(config.secondsBetweenGeoPositioning)||currentGeoPosition===undefined){se.activityIndicator.show();getGeoPosition(function(d){currentGeoPosition=d;console.debug("CURRENT GEO POSITION",currentGeoPosition);c();se.activityIndicator.hide()},function(d){if(a!=true){if(currentGeoPosition===undefined){currentGeoPosition={coords:{latitude:45.815005,longitude:15.978501}}}}c();se.activityIndicator.hide()})}else{c()}}function requireAuthentication(d,c,b,a){b=b?b:"ShoutemNetwork";c=c||{};if(user.authenticated(b)){d()}else{se.activityIndicator.hide();if(device.isNativeIPhone()){device.shoutem("showSignInForm",{complete:"onSignInFormComplete",context:c})}else{navigateTo(getScreenUrl("network_login",$.extend({autoOpened:true,authServer:b},params)))}}}var logout=function(){user.logout();reloadScreen()};var setAndroidOptionsMenu=device.platform=="native"&&device.name=="android"?function(b,c){b=b?b:"ShoutemNetwork";var a=[{label:M.home,url:"javascript:goToHomeScreen();",icon:"img/android/home.png"}];if(!c){a.push({label:M.refreshButtonTitle,url:"javascript:reloadScreen();",icon:"img/android/refresh.png"})}if(user.authenticated(b)){a.push({label:M.logout,url:"javascript:logout();",icon:"img/android/logout.png"})}device.call("ui/setOptionsMenu",{items:a})}:$.noop;function createAddressLine(b,d,c){var a=b;if(b){a+=", "}if(d){a+=d}if(c&&c!=d){a+=", "+c}return a}function getPlaceDistanceText(a,c){if(a==undefined||a.geo==undefined||currentGeoPosition==undefined||a.geo.coordinates[0]==undefined||a.geo.coordinates[1]==undefined){return}var e=Geocal.distance(a.geo.coordinates[0],a.geo.coordinates[1],currentGeoPosition.coords.latitude,currentGeoPosition.coords.longitude);var d=Geocal.angle(currentGeoPosition.coords.latitude,currentGeoPosition.coords.longitude,a.geo.coordinates[0],a.geo.coordinates[1]);var b=geoDistanceToString(e);if(c){b+=" "+M[geoAngleToString(d)]}return b}function createAuth(b,a){return Base64.encode(b+":"+a)}function getDeviceSource(){if(device.name=="iphone"){return"iPhone"}else{if(device.name=="android"){return"Android"}else{if(device.name=="nokia"){return"Nokia"}else{if(device.name=="opera mobi"){return"Opera Mobile"}else{return"Mobile"}}}}}function getFavoriteEntityTitle(a){if(a.favorite_entity_type=="Event"){return a.favorite_entity.name+" @ "+a.favorite_entity.place.name}if(a.favorite_entity_type=="Place"){return a.favorite_entity.name}if(a.favorite_entity_type=="Shout"){return a.favorite_entity.text}if(a.favorite_entity_type=="Profile"){return a.favorite_entity.screen_name}}function getFavoriteEntityUrl(a){if(a.favorite_entity_type=="Event"){return getEventDetailsUrl(a.favorite_entity.id)}if(a.favorite_entity_type=="Place"){return getPlaceDetailsUrl(a.favorite_entity.id)}if(a.favorite_entity_type=="Shout"){return getShoutDetailsUrl(a.favorite_entity.id)}if(a.favorite_entity_type=="Profile"){return getUserDetailsUrl(a.favorite_entity.id)}}function getShoutMessage(b,a){var c=linkify(sanitizeText(b.shoutem_text_format));c=c.replace("{*actor*}","");if(b.favorite_entity){if(c.indexOf("{*entity*}")!=-1){c=c.replace("{*entity*}","<em>"+getFavoriteEntityTitle(b)+"</em>")}}if(b.shoutem_place){var d=b.shoutem_place.name||b.shoutem_place;if(c.indexOf("{*place*}")!=-1){c=c.replace("{*place*}","<em>"+d+" </em>")}else{c=c+" @ <em>"+d+"</em>"}}if(b.shoutem_properties){if(c.indexOf("{*target*}")!=-1&&b.shoutem_properties.target_user){c=c.replace("{*target*}",'<span class="nick">'+b.shoutem_properties.target_user.screen_name+"</span>")}if(c.indexOf("{*badge*}")!=-1&&b.shoutem_properties.badge){c=c.replace("{*badge*}","<em>"+b.shoutem_properties.badge.name+"</em>")}}if(c.indexOf("{*")!=-1){console.error("could not parse `"+c+"` so displaying shout.text instead");c=linkify(sanitizeText(b.text))}if(!c){c="&nbsp;"}return c}function getShoutSourceText(a){return a.source.length>1?", "+a.source:""}String.prototype.hasPrefix=function(a){return this.indexOf(a)===0};function openExternalLink(c,b){if(!b){b=$(this).attr("href")}(c&&c.stopPropagation());if(!device.isNativeIPhone()&&b&&b.hasPrefix("shoutem://openInBrowser?url=")){b=b.substring("shoutem://openInBrowser?url=".length)}if(device.platform==="native"){(c&&c.preventDefault());var a=b||$(c.currentTarget).attr("href");if(a){device.call("load/url",{url:a,external:true})}}}function openInVideoPlayer(b){if(device.platform==="native"){b.stopPropagation();b.preventDefault();var a=$(b.currentTarget).attr("href");if(a){device.call("load/video",{url:a})}}else{openExternalLink(b)}}function openInAudioPlayer(b){if(device.platform==="native"){b.stopPropagation();b.preventDefault();var a=$(b.currentTarget).attr("href");if(a){device.call("load/audio",{url:a})}}else{openExternalLink(b)}}function getAvatarUrl(a){if(a&&a.profile_image_url&&a.profile_image_url.indexOf("avatarMedium.jpg")==-1){var b=a.profile_image_url;return b.replace("?type=large","?type=square")}else{return"img/avatarMedium.jpg"}}function getImageUrl(a){return a||"img/placeholder.png"}function getPlaceIconUrl(a){if(a.icon_url){return a.icon_url}if(a.primary_category&&a.primary_category.icon_url){return a.primary_category.icon_url}return"img/default-category.png"}function getPlaceCategoryIconUrl(a){return a.icon_url}function getEventIconUrl(a){if(a.type=="Concert"){return"img/events/concert.png"}if(a.type=="Exhibition"){return"img/event_exhibition.png"}return"img/events/default.png"}function isUserLiked(c,a){if(!a||!c){return false}for(var b=0;b<a.length;b++){if(c===a[b].id){return true}}return false}function getLikeLabel(d){var b=d.data[0];var f=d.data[1];var e=d.data[2];var a,c;if(d.like_id){if(b&&d.data.length>2){a=resolveOtherInLikeLabel(f,d.data.length-2);c=getMessage("userAndFriendAndOtherLike",b.name,a)}else{if(d.data.length>1){a=resolveOtherInLikeLabel(b,d.data.length-1);c=getMessage("userAndOtherLike",a)}else{c=getMessage("userLikes")}}}else{if(d.data.length){if(b){if(f&&d.data.length>2){a=resolveOtherInLikeLabel(e,d.data.length-2);c=getMessage("twoFriendsAndOtherLike",b.name,f.name,a)}else{if(d.data.length>1){a=resolveOtherInLikeLabel(f,d.data.length-1);c=getMessage("friendAndOtherLike",b.name,a)}else{c=getMessage("friendLikes",b.name)}}}else{if(d.data.length>1){c=getMessage("manyPeopleLike",d.data.length)}else{c=getMessage("onePersonLikes")}}}else{c=getMessage("firstToLike")}}return c}function resolveOtherInLikeLabel(b,c){var a;if(c<=0){return""}else{if(c>1){a=getMessage("otherManyPeople",c)}else{a=getMessage("otherOnePerson")}}return a}function loadLocalization(b,a){se.activityIndicator.show();if(["en","hr","kr"].indexOf(b)===-1){b="en"}jQuery.getScript("localization_"+b+".js",function(){if(network.shortcuts){$.each(network.shortcuts,function(d,c){if(!c.parameters.category_id){M[c.type]=c.name}})}a();se.activityIndicator.hide()})}function getPlacesUrl(a){return getScreenUrl("GenericScreen",{page:"TabbedPage:Category:000000000000000000:Geo"})}function getPlaceCategoriesUrl(b,a){var c={};c.subcat=a===undefined?true:a;if(b){c.categoryId=b}return getScreenUrl("places_categories",c)}function getLeadImageFromItem(a){if(a&&a.attachments&&a.attachments.images){var b=a.attachments.images[0];if(b&&b.width>$(window).width()/3&&b.height<$(window).height()){return b.src}}else{return a.images[0]}return false}function insertImageAttachments(d,a,e){if(!a||!a.length){return d}var b={width:$(window).width(),height:$(window).height()};var c=$("<span></span>");c.html(d);c.find("se-attachment, attachment, se\\:attachment").each(function(n,h){var f=$(h).attr("id");var j=0;var g;g=false;for(j=0;j<a.length;j++){if(a[j].id===f){g=a[j];break}}if(!g){return}if(g.src===e){return}if(!g){return}var l="unknown";if(g.width>=b.width/1.2){l="large"}else{if(g.width>=b.width/3){l="medium"}else{l="small"}}var m=false;var i=false;if(g.width){m=Math.min(g.width,b.width-42)+"px"}else{m="auto"}if(g.height){i=g.height/g.width*m+"px"}else{i="auto"}switch(l){case"large":case"medium":var k=$(renderEjs("article_image",{width:m,height:i,imageSrc:g.src}));k.css({margin:"10px auto 10px auto"});$(h).replaceWith(k);break;case"small":$(h).replaceWith("<img src='"+g.src+"' class='small-img'></img>");break}});return c.html()}function getPlaceDetailsTitle(){return getMessage("placeDetails")}function getPlaceDetailsUrl(a){return getScreenUrl("GenericScreen",{page:"DetailsPage:Category:000000000000000000",itemId:a})}function getShoutsUrl(){return getScreenUrl("shouts_list")}function getShoutDetailsUrl(a){return getScreenUrl("shouts_details",{shoutId:a})}function getCheckinUrl(a){var b={};b.type="checkin";if(a){b.placeId=a.id||a}return getScreenUrl("shouts_new",b)}function getEventCheckinText(a){if(a.place){return a.name+" @ "+a.place.name}return M.checkInAtEvent+a.name}function getEventShoutUrl(a){return getScreenUrl("shouts_new",{placeId:a.place?a.place.id:"",text:getEventCheckinText(a),type:"checkIn",subType:"eventShout"})}function getReshoutUrl(b,a,c){return getScreenUrl("shouts_new",{type:"reshout",shoutId:b,text:"RS @"+a+" "+c})}function toggleFriendshipStatus(a,c,b){if(a.shoutem_followed_by){network.deleteFriendship(a.id,function(){a.shoutem_followed_by=false;c()},b)}else{network.createFriendship(a.id,function(){a.shoutem_followed_by=true;c()},b)}}function getGoogleStaticMapSize(){var b=ui.contentSize();var a=(b.width<b.height?b.height:b.width);return b.width+"x"+Math.max(a-170,100)}function addMarkerToGoogleMap(b,g,a,h,i,c){var d=new google.maps.LatLng(g,a);var e=new google.maps.Marker({position:d,map:b,title:i,});if(h){e.icon=h}jBubbleContent=$(renderEjs("map_item",{feedItem:{label:i}}));var f=new InfoBubble({content:jBubbleContent.get()[0],disableAutoPan:true,hideCloseButton:true,padding:0,borderWidth:0,backgroundColor:"rgba(0,0,0,.2)",arrowSize:8,disableAnimation:true});jBubbleContent.bind("click",function(){f.close();(c||$.noop)()});google.maps.event.addListener(e,"click",function(){f.open(b,e)});google.maps.event.addListener(b,"click",function(){f.close()});return e}function createGoogleMap(b,a,c){se.activityIndicator.show();requireGoogleMapsApi(function(){var d=new google.maps.LatLng(currentGeoPosition.coords.latitude,currentGeoPosition.coords.longitude);var i=d;if(a){i=new google.maps.LatLng(a.coords.latitude,a.coords.longitude)}var f={zoom:16,center:i,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.ANDROID},streetViewControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM}};$("#mapCanvas").css("height",ui.contentSize().height);var h=new google.maps.Map(document.getElementById("mapCanvas"),f);var g;g=google.maps.event.addListener(h,"tilesloaded",function(){se.activityIndicator.hide();google.maps.event.removeListener(g)});var e=new google.maps.Marker({position:d});e.setMap(h);b(h)})}function getCommentUrl(b,a){return getScreenUrl("shouts_new",{type:"comment",inReplyToShoutId:b,text:"@"+a+" "})}function getNewShoutUrl(){return getScreenUrl("shouts_new",{type:"shout"})}function getNewPlaceUrl(){return getScreenUrl("places_new")}function getHomeUrl(){return getScreenUrl("home")}function goToHomeScreen(){if(currentScreen!="home"){navigateTo("home")}}function goToNearbyPlacesByCategory(a){network.getPlaceCategory(a,function(b){if(b.categories.length>0){navigateTo(getPlaceCategoriesUrl(a))}else{navigateTo(getPlacesUrl(a))}},function(){navigateTo(getPlaceCategoriesUrl(a))})}function getEditPlaceUrl(a){return getScreenUrl("places_new",{placeId:a})}function getEditPlaceTitle(a){return a?M.editPlace:M.addPlace}function getLoginUrl(){return getScreenUrl("network_login")}function getGeoSelectUrl(a){return getMessage("geo_edit",{back:a})}function getEventsCategoriesUrl(){return getScreenUrl("events_categories")}function getEventsUrl(a){var b=a?{categoryId:a}:undefined;return getScreenUrl("events_list",b)}function getEventDetailsUrl(a,b){return getScreenUrl("events_details",{eventId:a,categoryId:b})}function getImageAttachmentDetailsUrl(a){return getScreenUrl("attachment_details",{type:"picture",url:a})}function onClickGoTo(a){return"location.hash = '"+a+"'; return false;"}function getNewsUrl(a,c){var b={categoryId:a,feedName:c};return getScreenUrl("news",b)}function getNewsCategoriesUrl(a){return getScreenUrl("news_categories",{feedName:a})}function getNewsArticleUrl(b,a,c){return getScreenUrl("news_article",{categoryId:b,articleId:a,feedName:c})}function getNewsCommentUrlForDataSource(c,e){var b=getAuthServerForDataSource(e);var d=(c.commentable==="yes"&&!user.authenticated(b));var a=c.anonymous_contact_data_allowed;return getNewsCommentUrl(c.id,null,b,d,a,null,null,e.id)}function getNewsCommentUrlForFeed(d,c,f){var b=getAuthServerForFeed(f);var e=(f.provider_type!=="WebFeed"&&d.commentable!=="denied"&&!user.authenticated(b));var a=d.anonymous_contact_data_allowed;return getNewsCommentUrl(d.id,c,b,e,a,f.provider_type,f.rss_url)}function getNewsCommentUrl(h,a,f,i,e,c,g,d){var b={type:"news_comment"};if(h){b.url_id=h}if(d){b.dataSource=d}if(a){b.url=a}if(f){b.authServer=f}if(i){b.anonymous=i}if(c){b.providerType=c}if(g){b.providerUrl=g}if((typeof e)!=="undefined"){b.anonymous_contact_data_allowed=e}return getScreenUrl("shouts_new",b)}var refreshNewsFeed,toggleNewsLike,createNewsComment,shareNewsArticleLink;var onNewsCommentComplete,onNewsCommentLogin;function setNewsArticleOptionsMenu(c,b){var a=[];if(!c||c.commentable){a.push({label:M.actionSheetReplyButton,url:"javascript:createNewsComment()",icon:""})}if(!c||c.likeable){a.push({label:b?M.unlike:M.like,url:"javascript:toggleNewsLike()",icon:""})}if(c&&c.articleLink){a.push({label:M.share,url:"javascript:shareNewsArticleLink()",icon:""})}a.push({label:M.home,url:"javascript:goToHomeScreen();",icon:"img/android/home.png"});if(device.platform==="native"){device.call("ui/setOptionsMenu",{items:a})}}function seImageLoaded(b){var c=$(b.target);var a=c.parent();a.removeClass("img-loading");c.removeClass("img-loading");c.show()}function seImageLoadError(b){var c=$(b.target);var a=c.parent();a.removeClass("img-loading");a.addClass("img-loading-failed");c.removeClass("img-loading");c.addClass("img-loading-failed")}function centerImage(a){var d=$(a.target);var f=d.parent();var b=d.width();var g=d.width()||d[0].width||0;var e=d.height()||d[0].height||0;var i=f.width();var j=f.height();var c=(i-g)/2;var h=(j-e)/2;d.css({left:c+"px",top:h+"px"})}function newsImageLoaded(a){cropImage(a)}function cropImage(b,h){if(b.target){var d=$(b.target)}else{var d=b}d.addClass("loaded");var i=d.parent();d.show();if(!i.hasClass("crop")&&!i.hasClass("se-crop")){return}var j=parseInt(d.outerWidth()||d[0].width||0,10);var f=parseInt(d.outerHeight()||d[0].height||0,10);var l=parseInt(i.width(),10);var m=parseInt(i.height(),10);if(j===0||f===0||l===0||m===0){return}console.debug("image ["+j+","+f+"] container["+l+","+m+"]");if(f&&j){var e,a;var g=j/f;if(Math.abs(j-l)>g*Math.abs(f-m)){a=m;e=Math.round(j*a/f);d.width(e);d.height(a);var c=(l-e)/2;console.debug("new left"+c);d.css({left:c+"px"})}else{e=l;a=Math.round(f*e/j);var k=(m-a)/2;console.debug("new top"+k+" new width: "+e+" new height "+a);d.css({top:k+"px",width:e+"px",height:a+"px"})}}i.removeClass("img-loading");d.removeClass("img-loading");d.show()}function newsImageLoadError(a){$(a.target).remove()}var getSizedImage=function(c){if(!getSizedImage.categories){getSizedImage.categories={small:["-Ti.","-Th.","-S.","_s."],medium:["-M.","_m."],large:["-L.","-XL.","-X2.","-X3.","-O."]}}var f,d,e;var b=function(j,k){var g,h;for(g=0;g<j.length;g++){h=c.split(j[g]);if(h.length>1&&h[h.length-1].length<=4){return{imageParts:h,imageUrl:c,size:k,imageName:h.join()}}}};var a=b(getSizedImage.categories.small,"s")||b(getSizedImage.categories.medium,"m")||b(getSizedImage.categories.large,"l")||{imageUrl:c,imageName:c};return a};var getImageOfSize=function(d,e,a){if(!d){return}if(!e){return d}var c,b;d=getSizedImage(d);for(c=0;c<e.length;c++){b=getSizedImage(e[c]);if(b.size&&a.indexOf(b.size)>=0&&d.imageName==b.imageName){return b.imageUrl}}return d.imageUrl};var getPhotoFeedImage,getVideoFeedImage;(function(){var a=$("<span></span>");getPhotoFeedImage=function(e){var c;if(e.images&&e.images.length>0){c=getImageOfSize(e.images[0],e.images,"lm")}if(!c){c=e.thumbnail}var b=function(f,h){if(!f){return}if(!h){h="a img"}f=sanitizeHtml(f);var g=$("<span></span>");g.html(f);var i=g.find(h).attr("src");g.html("");return i};var d=function(f){var g=b(f,"a img[src*='flickr.com/']");if(g){g=g.replace("_m","_s")}return g};if(!c){c=d(e.content)||b(e.content)}if(!c){c=d(e.summary)||b(e.summary)}if(!c){return""}return c};getVideoFeedImage=function(c){var b=c.images[0];if(!b){b=c.thumbnail}if(!b){a.html(sanitizeHtml(c.content||c.summary,true));b=a.find("img:first").attr("src")||"";a.html("")}return b}})();var shortenUrl=(function(){var a="http://api.bit.ly/v3/shorten";var b={login:"shoutem",apiKey:"R_92f94022d9143a24891b458b40e4ee04",format:"json",longUrl:null};return function(c,d){if(c){b.longUrl=c;se.activityIndicator.show();$.getJSON(a,b,function(f,e,h){se.activityIndicator.hide();var g="";if(h.status===200&&f&&f.status_code===200){g=f.data.url}(d||$.noop)(g)})}else{(d||$.noop)("")}}})();function loadFBJSSDK(a){var f=document;var b="script";var g="facebook-jssdk";var e,c=f.getElementsByTagName(b)[0];e=f.createElement(b);e.id=g;e.src="http://connect.facebook.net/en_US/all.js#xfbml=1&appId="+a;c.parentNode.insertBefore(e,c)}function getUserDetailsUrl(a){var b={};if(a){b.userId=a}return getScreenUrl("users_details",b)}function getUserShoutsUrl(a){return getScreenUrl("shouts_list",{userId:a.id,userName:a.screen_name})}function getNotificationsUrl(){return getScreenUrl("notifications")}function getYouTubeVideoId(a){match=a.match(/\/v\/([^\?\&]+)/);if(!match){match=a.match(/\?v=([^\&]+)/)}if(match){return match[1]}return null}function getVideoUrl(b){var a,c="";if(b.indexOf("youtube.com/")>=0){a=b.match(/\/v\/([^\?\&]+)/);if(!a){a=b.match(/\?v=([^\&]+)/)}if(a){if(device.name!=="android"){c="http://www.youtube.com/v/"}else{c="ytv://"}c+=a[1]}}else{c=b}return c}function canPlayEmbeddedVideo(a){if(device.name!=="iPhone"){return false}return a.indexOf("youtube.com/")>=0||a.indexOf("vimeo.com/")>=0||a.indexOf(".mp4")>=0}function getYouTubeThumbnailUrl(a){if(a&&a.src&&a.src.indexOf("youtube.com")){var b=getYouTubeVideoId(a.src);return"http://i.ytimg.com/vi/"+b+"/default.jpg"}}function getVideoImageUrl(a){if(a.src.indexOf("youtube.com/")>=0){var b=getYouTubeVideoId(a.src);if(b){return"http://i.ytimg.com/vi/"+b+"/hqdefault.jpg"}}return"theme/img/audio-play.png"}function canPlayEmbeddedAudio(){return device.name!=="android"}function getSearchUrl(){return getScreenUrl("search")}function getSearchMembersUrl(){return getScreenUrl("search_members")}function getUserFriendsUrl(a){return getScreenUrl("friends_list",{userId:a})}function getUserFollowersUrl(a){return getScreenUrl("followers_list",{userId:a})}function getUsersUrl(){return getScreenUrl("users_list")}function getAddFriendsUrl(){return getScreenUrl("add_friends")}function getAddFriendsListUrl(a){return getScreenUrl("add_friends_list",{source:a})}function getEditProfileUrl(){return getScreenUrl("edit_profile",{})}function getBadgesUrl(a){var b={};if(a){b.userId=a}return getScreenUrl("badges_list",b)}function getBadgeDetailsUrl(b,a){return getScreenUrl("badges_details",{userId:b,badgeId:a})}function getMessagesUrl(){return getScreenUrl("messages_list")}function getMessagesConversationUrl(a){return getScreenUrl("messages_conversation",{messageId:a})}function getNewMessageUrl(b){var a={};if(b){params.recipientId=b}return getScreenUrl("messages_new")}function getUrlCategoriesUrl(){return getScreenUrl("url_categories")}function getPhotoDetailsUrl(b,a){return getScreenUrl("photo_details",{categoryId:b,articleId:a})}function getAudioFeedUrl(a){var b=a?{categoryId:a}:undefined;return getScreenUrl("audio_feed",b)}function getAudioCategoriesUrl(){return getScreenUrl("audio_categories")}function getAudioDetailsUrl(b,a){return getScreenUrl("audio_details",{categoryId:b,articleId:a})}function getPlacesTweetsUrl(a){return getScreenUrl("places_tweets",{placeId:a.id})}function getPlacesYelpUrl(a){return getScreenUrl("places_yelp",{placeId:a.id})}function canShowNewsDetails(a){return !(device.platform==="native"&&(a||"").indexOf("slideshare.net/")>=0)};
