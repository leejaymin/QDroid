var cookie={};cookie.each=function(d){var c=document.cookie.split(";");for(var b=0;b<c.length;b++){var a=c[b].split("=")[0];d(a)}};cookie.get=function(a){var b=RegExp(a+"=([^;]+)").exec(document.cookie);return b?(b[1]!=""?b[1]:undefined):undefined};cookie.set=function(a,b){document.cookie=a+"="+b.toString()};cookie.remove=function(a){document.cookie=a+"=; expires=Thu, 01-Jan-70 00:00:01 GMT;"};
DB=(function(){var b,c,a;if(window.localStorage){console.info("DB uses window.localStorage");b=function(d){var e=window.localStorage.getItem(d);console.debug("DB GET "+d+" : "+((e||"").length>100?e.substr(0,100)+"[...]":e));return e};c=function(d,e){console.debug("DB SET "+d+" = "+((e||"").length>100?e.substr(0,100)+"[...]":e));window.localStorage.setItem(d,e)};a=function(d){console.debug("DB REMOVE "+d);window.localStorage.setItem(d,undefined)}}else{console.info("DB uses cookies");b=function(d){var e=cookie.get(d);console.debug("DB GET "+d+" : "+((e||"").length>100?e.substr(0,100)+"[...]":e));return e};c=function(d,e){console.debug("DB SET "+d+" = "+((e||"").length>100?e.substr(0,100)+"[...]":e));e==undefined?cookie.remove(d):cookie.set(d,e)};a=function(d){console.debug("DB REMOVE "+d);cookie.remove(d)}}return{get:function(d){var f=b(d);if(f){try{return JSON.parse(f)}catch(g){if(f==="undefined"){f=null}this.set(d,f);return f}}},set:function(d,e){c(d,JSON.stringify(e))}}})();
AudioPlayerContstants={eventType:{loadStart:"loadstart",waiting:"waiting",playing:"playing",timeUpdate:"timeupdate",pause:"pause",ended:"ended",emptied:"emptied",progress:"progress",load:"load",error:"error",suspend:"suspend",abort:"abort",stalled:"stalled",loadedmetadata:"loadedmetadata",loadeddata:"loadeddata",canplay:"canplay",canplaythrough:"canplaythrough",seeking:"seeking",seeked:"seeked",durationchange:"durationchange"},playerStatus:{buffering:"buffering",playing:"playing",stopped:"stopped",notLoaded:"notLoaded"}};AudioPlayer=function(a){this.container=a;this.canPlay=false;this.audioElement=a.find("audio").get(0);this.sliderControl=a.find("#slider-control").get(0);this.currentTimeLabel=a.find("#time");this.sliderThumb=a.find("#slider-thumb");this.sliderTrail=a.find("#slider-trail");this.sliderBar=a.find("#slider-bar").get(0);this.sliderControlOffsetLeft=0;this.sliderControlWidth=$(this.sliderControl).outerWidth();this.playPauseBtn=a.find("#play-pause-btn");this.status=AudioPlayerContstants.playerStatus.notLoaded;this.setPlayerStatus(AudioPlayerContstants.playerStatus.notLoaded);var c=$(this.audioElement);for(var b in AudioPlayerContstants.eventType){this.audioElement.addEventListener(AudioPlayerContstants.eventType[b],this,false)}this.resizeDisplayArea();this.playPauseBtn.get(0).addEventListener("click",this,false);this.sliderControl.addEventListener("touchstart",this,false);this.sliderControl.addEventListener("touchout",this,false);this.sliderControl.addEventListener("touchend",this,false)};AudioPlayer.prototype.resizeDisplayArea=function(){this.sliderControlWidth=$(this.sliderControl).outerWidth()};AudioPlayer.prototype.handleEvent=function(b){var a=b.type;console.debug("Event type: "+a);switch(a){case"touchstart":case"touchout":case"touchend":case"touchmove":this.handlePositionDrag(b);break;case"click":if(b.currentTarget==this.playPauseBtn.get(0)){this.onPlayPauseButtonClick()}break;case AudioPlayerContstants.eventType.loadStart:this.setPlayerStatus(AudioPlayerContstants.playerStatus.stopped);break;case AudioPlayerContstants.eventType.waiting:this.setPlayerStatus(AudioPlayerContstants.playerStatus.buffering);break;case AudioPlayerContstants.eventType.playing:this.setPlayerStatus(AudioPlayerContstants.playerStatus.playing);break;case AudioPlayerContstants.eventType.canplay:this.canPlay=true;this.setPlayerStatus(AudioPlayerContstants.playerStatus.stopped);break;case AudioPlayerContstants.eventType.load:case AudioPlayerContstants.eventType.progress:this.gotMoreData();break;case AudioPlayerContstants.eventType.timeUpdate:this.updatePlayerTime();break;case AudioPlayerContstants.eventType.error:this.playPauseBtn.get(0).removeEventListener("click",this,false);this.sliderThumb.hide();break;case AudioPlayerContstants.eventType.ended:this.moveThumb(0);this.audioElement.pause();case AudioPlayerContstants.eventType.pause:case AudioPlayerContstants.eventType.emptied:this.setPlayerStatus(AudioPlayerContstants.playerStatus.stopped);break}};AudioPlayer.prototype.setPlayerStatus=function(a){if(!this.canPlay){return}switch(a){case AudioPlayerContstants.playerStatus.notLoaded:this.playPauseBtn.removeClass("pause").removeClass("not-loaded").addClass("play");break;case AudioPlayerContstants.playerStatus.stopped:this.playPauseBtn.removeClass("pause").removeClass("not-loaded").addClass("play");break;case AudioPlayerContstants.playerStatus.buffering:this.sliderThumb.show();break;case AudioPlayerContstants.playerStatus.playing:this.sliderThumb.show();break}this.status=a};AudioPlayer.prototype.getDuration=function(){return this.audioElement.duration};AudioPlayer.prototype.gotMoreData=function(){};AudioPlayer.prototype.updatePlayerTime=function(){if(this.status===AudioPlayerContstants.playerStatus.stopped||this.status===AudioPlayerContstants.playerStatus.notLoaded){return}if(!this.userDraggingTimeControl){var a=parseInt(this.audioElement.currentTime/this.getDuration()*100,10);this.moveThumb(a)}this.currentTimeLabel.html(this.formatTime(this.audioElement.currentTime))};AudioPlayer.prototype.onPlayPauseButtonClick=function(){if(!this.canPlay){return}switch(this.status){case AudioPlayerContstants.playerStatus.buffering:case AudioPlayerContstants.playerStatus.playing:this.playPauseBtn.removeClass("pause").addClass("play");this.audioElement.pause();break;case AudioPlayerContstants.playerStatus.stopped:case AudioPlayerContstants.playerStatus.notLoaded:this.audioElement.play();this.playPauseBtn.removeClass("play").addClass("pause");break}};AudioPlayer.prototype.handlePositionDrag=function(b){b.stopPropagation();if(this.status!==AudioPlayerContstants.playerStatus.playing&&this.status!==AudioPlayerContstants.playerStatus.buffering){return}switch(b.type){case"touchstart":if(b.touches&&b.touches.length>0){var c=b.touches[0];this.touchIdentifier=c.identifier;this.positionDrag(c);this.userDraggingTimeControl=true;this.sliderControl.addEventListener("touchmove",this,true)}break;case"touchout":case"touchend":this.changeCurrentTime(this.selectedTime);this.sliderControl.removeEventListener("touchmove",this,true);this.userDraggingTimeControl=false;delete this.selectedTime;delete this.touchIdentifier;break;case"touchmove":var c=b.touches[0];for(var a=0;a<b.touches.length;a++){if(b.touches[a].identifier=this.touchIdentifier){c=b.touches[a];break}}this.positionDrag(c);break}};AudioPlayer.prototype.changeCurrentTime=function(a){if(!a){return}this.audioElement.currentTime=a};AudioPlayer.prototype.positionDrag=function(d){var c=$(this.sliderControl).offset().left;var b=$(this.sliderControl).outerWidth();var a=Math.max(d.screenX-c,0);percentage=Math.min(a*100/b,100);console.debug("Touch: "+d.screenX+" width: "+b+" Slider left: "+c+" offsetX: "+a+" percentage: "+percentage);if(typeof(percentage)!=="number"){return false}this.moveThumb(percentage);this.selectedTime=percentage*this.getDuration()/100;return true};AudioPlayer.prototype.moveThumb=function(a){if(parseInt(this.sliderThumb.css("left"),10)!==a){this.sliderTrail.css("width",a+"%");this.sliderThumb.css("left",a+"%")}};AudioPlayer.prototype.formatTime=function(a){return formatTime(a,"hh:mm:ss")};var createPlayerList=function(d,b){var c=[];$.each(d,function(e,f){c.push(renderEjs("audio_player_item",{feedItem:{title:f.title,audio_url:(f.audioLinks[0]||f.articleLink)}}))});b.html(c.join(""));var a=[];b.find(".se-audio-player").each(function(e,f){a.push(new AudioPlayer($(f)))});return a};
function getServiceClient(e,k){if(e.indexOf("%s")==-1){if(k.methodParameterName===undefined){e+="/%s"}}var d={appendTypeToUrl:true,type:"json",timeout:30000,authorizationHeader:"Authorization",onAjaxStart:$.noop,onAjaxComplete:$.noop,status:$(document)};k=$.extend({},d,k);k.defaultParams={};var a=[];var c={};var j={};function i(l,n,m){if(j.url==l&&compareByContent(j.data,n)&&j.auth==m){return true}j={url:l,data:n,auth:m};return false}function b(l,m){return l+JSON.stringify(m)}function h(m,l,q,o,u,t,p,r){if(!u){u=$.noop}if(!t){t=$.noop}var s=b(m,q);if(c[s]&&!secondsHadPassed(config.networkCacheSecondsToLive)){console.debug("AJAX CACHE HIT "+m);u(c[s]);j={}}else{var n=function(v){console.debug("AJAX CACHE ADD "+m);c[s]=v;u(v);j={}};g(m,l,q,o,n,t,p,r)}}function g(n,m,r,o,w,t,p,s){if(config.debug){console.debug("AJAX "+m+" "+n+" "+(r?JSON.stringify(r)+" ":""))}s=s?s:{};if(!w){w=$.noop}if(!t){t=$.noop}if(s.absolute){var u=k.type}var v=m=="GET"?"application/"+u:"application/x-www-form-urlencoded";var l=n.indexOf("count.json")>=0||s.inBackground;k.status.trigger("apiAjaxStart",[l]);k.onAjaxStart(l);for(var q in r){if(typeof(r[q])==="string"&&r[q]===""){delete r[q]}}a.push($.ajax({url:n,dataType:u,contentType:v,cache:false,data:serviceClientfilterDataHook(k,r,p),type:m,timeout:k.timeout,beforeSend:function(x){serviceClientBeforeSendHook(k,x,p)},error:function(z,x){j={};try{console.debug("AJAX ERROR"+(x?" "+x:"")+(z?" "+z.status:""))}catch(y){console.debug("AJAX ERROR"+(x?" "+x:""))}t(z,x)},success:function(z,y,A){j={};if(z==null||A.status===0){if(config.debug){console.debug("AJAX ERROR empty")}t(A,"empty")}else{if(config.debug){console.debug("AJAX SUCCESS",z)}try{w(z)}catch(x){if(config.debug){throw (x)}}}},complete:function(y,x){k.onAjaxComplete(l);k.status.trigger("apiAjaxComplete",[l])}}))}function f(l){if(k.methodParameterName){l=""}return e.replace("%s",l)+(k.appendTypeToUrl&&l.indexOf(".json")==-1&&l.indexOf(".xml")==-1?"."+k.type:"")}return{auth:k.auth,defaultParams:k.defaultParams,abort:function(){$.each(a,function(l,m){m.abort()});a=[];j={}},cacheKeyFor:b,clearCache:function(l){if(l){c[l]={}}else{c={}}},error:k.error,GET:function(n,q,r,m,l,p,o){if(i(n,q,this.auth)){return}if(l===undefined){l=true}if(o&&o.absoluteUrl){g(n,"GET",$.extend({},this.defaultParams,q||{}),this.auth,r,m||this.error,p,o)}else{if(k.methodParameterName){if(q==undefined){q={}}q[k.methodParameterName]=n}(l?h:g)(f(n),"GET",$.extend({},this.defaultParams,q),this.auth,r,m||this.error,p,o)}},POST:function(m,p,q,l,o,n){if(i(m,p,this.auth)){return}if(k.methodParameterName){if(p==undefined){p={}}p[k.methodParameterName]=m}g(f(m),"POST",$.extend({},this.defaultParams,p),this.auth,q,l||this.error,o,n)}}}function getAuthData(b,c){if(c){return c}if(b.authServer){var a=user.identities.findIdentity(b.authServer);if(a){return{authenticated:a.sessionId!==undefined||a.userId!==undefined,id:a.userId,sessionId:a.sessionId,authType:(a.authType)?a.authType:"basic"}}else{return{authenticated:false}}}return{authenticated:false}}function serviceClientBeforeSendHook(a,c,b){b=getAuthData(a,b);if(b.authType!=="basic"){return}if(b.authenticated){c.setRequestHeader(a.authorizationHeader,"Basic "+b.sessionId)}}function serviceClientfilterDataHook(a,c,b){b=getAuthData(a,b);if(b.authenticated&&b.authType==="url"&&b.sessionId){c.session_id=b.sessionId}return c};
M=window.M={};function timeDistanceInWords(g,f){var d=new Date(g).getTime();var c=(f||new Date()).getTime();var e=Math.round((c-d)/1000);var b=Math.round(e/60);var a=Math.round(b/60);if(e<=0){return getMessage("now")}else{if(e<60){return getMessage("timeDistanceSeconds",e)}else{if(b<60){return getMessage("timeDistanceMinutes",b)}else{if(a<24){return getMessage("timeDistanceHours",a)}}}}return renderTime(g)}function formatTime(d,c){var a=""+(Math.floor(d/3600));var b=""+(Math.floor((d-a*3600)/60));var e=""+(Math.floor(d-a*3600-b*60));e=(e.length===1)?"0"+e:e;b=(b.length===1)?"0"+b:b;a=(a.length===1)?"0"+a:a;c=c.replace(/hh/g,a);c=c.replace(/mm/g,b);c=c.replace(/ss/g,e);return c}function convertDate(c,b){if(!c){return}if(!b){var a=new Date();c=c.replace(/[\+-]([0-9])+/i,a.getUTCOffset());date=new Date(c);return date.toUTCString()}return c}function getDateFmt(a){a=a.toUpperCase();if(a=="EN_US"){return"dd-MMM-yyyy"}return"dd.MM.yyyy"}function renderEventTime(d,b,c,a){if(!d){return}return renderTime(d,a,c)+((b)?(" - "+renderTime(b,a,c)):"")}function metersToMiles(a){return a/1609.344}function milesToYards(a){return a*1760}function yardsToFeet(a){return a*3}function distanceToStringMetric(a){if(a<1){return Math.round(a*1000)+"m"}else{return Math.round(a*10)/10+"km"}}function distanceToStringImperial(a){if(a<1){var b=milesToYards(a);return Math.round(b)+"yd"}else{return Math.round(a*10)/10+"mi"}}function geoDistanceToString(a){if(device.locale.measurementSystem=="Metric"){return distanceToStringMetric(a)}else{return distanceToStringImperial(metersToMiles(a*1000))}}function geoAngleToString(b){var a;if(b>=-Math.PI/8&&b<=Math.PI/8){a="east"}else{if(b>=Math.PI/8&&b<=Math.PI*3/8){a="northEast"}else{if(b>=Math.PI*3/8&&b<=Math.PI*5/8){a="north"}else{if(b>=Math.PI*5/8&&b<=Math.PI*7/8){a="northWest"}else{if(b>=Math.PI*7/8||b<=-Math.PI*7/8){a="west"}else{if(b<=-Math.PI/8&&b>=-Math.PI*3/8){a="southEast"}else{if(b<=-Math.PI*3/8&&b>=-Math.PI*5/8){a="south"}else{if(b<=-Math.PI*5/8&&b>=-Math.PI*7/8){a="southWest"}}}}}}}}return a}var relativeHrefsToApsolute=function(a,b){var c=/href\s*?=\s*?['"]\/(.*?)['"]/;return(a||"").replace(c,"href='http://"+b+"/$1'")};var linkify=(function(){var a=/(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|]/ig;return function(b){return(b||"").replace(a,"<a href='$&'>$&</a>")}})();var stripTags=(function(){var a=$("<span></span>");return function(b){if(!b){return""}var c=a.html(sanitizeHtml(b,true)).text();a.html("");return c}})();var escapeHtml=(function(){var a=$("<span></span>");return function(b){return a.text(b).html()}})();function sanitizeText(a){a=$.trim(a);a=escapeHtml(a);return a.replace(/\n+/g,"<br />")}var sanitizeHtml=(function(){var d=/\n/g;var b=/<(script|iframe).*?>.*?<\/\1>/ig;var f=/<\/?(script|iframe).*?\/?>/ig;var h=/(<[^\s\/]+)\s*((?:\s*[\w-_]+(?:\s*=\s*(?:\"[^\"]*?\"|'[^']*?'|[^'\"<>\s]+)?))*)\s*(\/?>)/ig;var a=/(?:on\w+|style|width)(?:\s*=\s*(?:\"[^\"]*?\"|'[^']*?'|[^'\"<>\s]+)?)/ig;var e=/(?:href|src)(?:\s*=\s*(?:\"javascript:.*?\"|'javascript:.*?'|javascript))/ig;var g=/<(a).*?href(?:\s*=\s*(\"itms:.*?\"|\"itms:.*?\')).*?>.*?<\/\1>/ig;var c=function(l,k,j,i,n,m){if(j){j=j.replace(a,"");j=j.replace(e,"")}return k+" "+j+" "+i};return function(i,j){if(typeof(i)!=="string"){return i}if(!j){i=i.replace(d,"")}i=i.replace(b," ");i=i.replace(f," ");if(!device.supports.iTunesLink){i=i.replace(g,"")}if(!j){i=i.replace(h,c)}return i}})();function pluralize(c,b,a){return c+" "+(parseInt(c)==1?b:a)}function getTextExcerpt(d,c){if(d.length<=c){return d}var a=d.slice(0,c);var b=a.lastIndexOf(" ");if(b==-1){b=a.lastIndexOf(".")}if(b!=-1){a=a.slice(0,b)}else{a=a.slice}return a+"..."}function shortenUrl(c){var b=c.replace(/^[a-z]+\:\/\//,"");var a=b.lastIndexOf("/");if(a!=-1&&a!=(b.length-1)){b=b.substr(0,a)+"/..."}return b}function shorten(b,a){return(b.length<=a)?b:b.substring(0,a-3)+"..."}function shortenShorcutName(a){if(!a){return""}return(a.length<=13)?a:a.substring(0,5)+"..."+a.substring(a.length-5)}function getMessage(){var b=arguments[0];if(M[b]){if(arguments.length>1){var a=cloneObj(M[b]);$.each(arguments,function(c,d){a=a.replace("{"+c+"}",d)});return a}else{return M[b]}}else{return b}};
var shoutem=window.shoutem={};shoutem.providers={};shoutem.services={};shoutem.services.ServiceClient=function(a){return getServiceClient(a.url,{appendTypeToUrl:a.appendTypeToUrl===undefined?true:a.appendTypeToUrl,timeout:config.networkTimeout,authorizationHeader:config.authorizationHeader,error:onErrorResponse,status:a.status,methodParameterName:a.methodParameterName,authServer:a.authServer})};$(document).bind("apiAjaxStart",function(b,a){if(!a){se.activityIndicator.show()}});$(document).bind("apiAjaxComplete",function(b,a){if(!a){se.activityIndicator.hide()}});
var ShoutemApp=(function(){var a={p:{config:null,getFromObjectList:function(e,c,d){for(var b=0;b<e.length;b++){if(e[b][c]===d){return e[b]}}return false}},setConfig:function(b){a.p.config=b},FEED_TYPE:{NEWS_FEED:"newsFeeds",EVENT_FEEDS:"eventFeeds",URL_FEEDS:"urlFeeds",CATALOG_FEEDS:"catalogFeeds"},getFeed:function(b,e){var c=a.p.config[b];var d=c[0];$.each(c,function(f,g){if((""+g.id.toString())===(""+e)){d=g}});return d},getFeeds:function(b){return a.p.config[b]},MODULES:{HOME_SCREEN_GRID:"HomeScreenGrid",COMMUNITY:"Community",ADS:"Ads"},getModule:function(b){return a.p.getFromObjectList(a.p.config.configuration.modules,"type",b)},getConfiguration:function(){return a.p.config.info},getDatasources:function(){return a.p.config.appConfig.dataSources},getPages:function(){return a.p.config.appConfig.pages},getDatasourceByRef:function(b){if(b["$ref"]){return a.p.getFromObjectList(a.getDatasources(),"id",b["$ref"])}else{if(b.id){return b}}},getPageByRef:function(b){if(!b){return false}if(b["$ref"]){return a.p.getFromObjectList(a.getPages(),"id",b["$ref"])}else{return b}},getPage:function(c,b){return a.p.getFromObjectList(a.getPages(),b,c)},getProperties:function(){if(!a.p.properties){a.p.properties={isCheckInEnabled:function(){return typeof a.getModule(a.MODULES.COMMUNITY)!=="undefined"},isLoadMoreEnabled:function(){var b=a.getModule(a.MODULES.COMMUNITY);return b&&b.community_type!="ning"}}}return a.p.properties}};return a})();TestShoutemApp=function(){test("TestShoutemApp datasource get by ref test",function(){var b=ShoutemApp.getDatasourceByRef({"$ref":"ds2"});var a=ShoutemApp.getDatasources()[1];ok(JSON.stringify(b)==JSON.stringify(a))})};
ui={};var refreshNavigationBarButton=new RefreshNavigationBarButton();(function(b){ui.contentSize=function(){var f=b(window).width();var d;if(b(".tabLinks").length){var e=b(".tabLinks").position().top+b(".tabLinks").height();d=b(window).height()-e}else{var e=0;if(b("#content h1").length){e=b("#content h1").position().top+b("#content h1").height()}d=b(window).height()-e}return{width:f,height:d}};ui.error=function(d){ui.message(d,M.networkInfoErrorMessageTitle)};ui.message=function(e,f){if(device.platform==="native"){var d={title:f||"",text:e||"",options:[{label:M.confirmOk,url:""}]};device.call("ui/showDialog",d)}else{alert(e)}};ui.activityIndicator="spinner";ui.showActivityIndicator=function(){if(ui.activityIndicator=="search"){b(".searchIcon").addClass("activity");return}var d=b("#activityIndicator");d.data("count",d.data("count")+1);var e=function(){if(d.data("count")>0){if(device.platform==="native"){device.call("ui/showActivityIndicator",{visible:true})}else{var f=window.pageYOffset+(b(window).height()/2)-b("#activityIndicator").height();d.css("top",f+"px").show()}}};e()};ui.hideActivityIndicator=function(){if(ui.activityIndicator=="search"){b(".searchIcon").removeClass("activity");ui.activityIndicator="spinner";return}var d=b("#activityIndicator");var e=d.data("count");if(e>0){e-=1;d.data("count",e)}if(e===0){if(device.platform==="native"){device.call("ui/showActivityIndicator",{visible:false})}else{d.hide()}}};var a=null;var c;ui.setupSearchField=function(d,e,h){var f=3;var g=600;b("#query").val(d).focus().keydown(function(){if(a){clearTimeout(a);a=null}a=setTimeout(function(){var i=b("#query").val();if(c===i){return}if(i.length>=f){b(".searchIcon").addClass("activity");ui.activityIndicator="search";c=i;e(i)}if(i.length==0&&h){c=i;h("")}},g)});if(d&&d.length>=f){e(d)}}})(jQuery);
